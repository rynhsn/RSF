@inherits R_Page

<R_StackLayout Row Spacing="2">
    <R_ItemLayout col="3">
        <R_Grid @ref="@_gridRef"
                DataSource="@_viewModel.Properties"
                R_GridType="@R_eGridType.Original"
                R_ConductorGridSource="@_conPropertyRef"
                R_ServiceGetListRecord="@BillingParamGrid_GetListAsync"
                R_Display="@BillingParamGrid_DisplayAsync"
                Height="590px"
                Enabled="_enableGrid"
                AllowAddNewRow="@false"
                AllowEditRow="@false"
                AllowDeleteRow="@false"
                Pageable
                @bind-PageSize="_pageSizeProperty">
            <R_GridColumns>
                <R_GridTextColumn FieldName="@nameof(PropertyDTO.CPROPERTY_NAME)"
                                  HeaderText="@_localizer["_column_property"]" />
            </R_GridColumns>
        </R_Grid>
    </R_ItemLayout>
    <R_ItemLayout auto="false">
        <R_StackLayout Justify="R_eJustify.SpaceBetween" Style="height:100%;">
            @* forms *@
            <R_StackLayout>
                <R_GroupBox Title=@_localizer["_grp_onlinepayment"] Class="px-2">

                    @* date & submit by *@
                    <R_StackLayout Row>
                        <R_ItemLayout col="2">
                            <R_Label>@_localizer["_lbl_startdate"]</R_Label>
                        </R_ItemLayout>
                        <R_ItemLayout auto="false">
                            <R_DatePicker @bind-Value="@_viewModel.Data.DOL_PAY_START_DATE"
                                          R_ConductorSource="@_conBillingRef"
                                          R_EnableAdd
                                          R_EnableEdit></R_DatePicker>
                        </R_ItemLayout>
                        <R_ItemLayout col="2" Class="d-flex justify-content-center">
                            <R_Label>@_localizer["_lbl_submitby"]</R_Label>
                        </R_ItemLayout>
                        <R_ItemLayout auto="false">
                            <R_ComboBox Data="@_viewModel.PaymenSubmitByList"
                                        @bind-Value="@_viewModel.Data.COL_PAY_SUBMIT_BY"
                                        ValueField="@nameof(GeneralTypeDTO.CCODE)"
                                        TextField="@nameof(GeneralTypeDTO.CNAME)"
                                        Enabled="@(_conBillingRef.R_ConductorMode!=R_eConductorMode.Normal)">
                            </R_ComboBox>
                        </R_ItemLayout>
                    </R_StackLayout>

                    @* currencies *@
                    <R_StackLayout Row>
                        <R_ItemLayout col="2"><R_Label>@_localizer["_lbl_currency"]</R_Label></R_ItemLayout>
                        <R_ItemLayout col="3">
                            <R_TextBox @bind-Value="@_viewModel.Data.COL_PAY_CURRENCY"
                                       R_ConductorSource="@_conBillingRef"
                                       OnLostFocus="@OnLostFocus_CurrencyAsync"
                                       MaxLength="3"
                                       R_EnableAdd
                                       R_EnableEdit />
                        </R_ItemLayout>
                        <R_ItemLayout>
                            <R_Lookup R_Before_Open_Lookup="@BeforeOpenPopup_Currency"
                                      R_After_Open_Lookup="@AfterOpenPopup_CurrencyAsync"
                                      R_ConductorSource="@_conBillingRef"
                                      R_EnableAdd
                                      R_EnableEdit>
                                ...
                            </R_Lookup>
                        </R_ItemLayout>
                        <R_ItemLayout auto="false">
                            <R_TextBox @bind-Value="@_viewModel.Data.COL_PAY_CURRENCY_DESCRIPTION" Enabled="@false"></R_TextBox>
                        </R_ItemLayout>
                    </R_StackLayout>

                    @* include penalty *@
                    <R_StackLayout Row>
                        <R_ItemLayout>
                            <R_CheckBox @bind-Value="@_viewModel.Data.LOL_PAY_INCL_PENALTY" R_ConductorSource="@_conBillingRef" R_EnableAdd R_EnableEdit />
                        </R_ItemLayout>
                        <R_ItemLayout>
                            <R_Label>@_localizer["_chk_includepenalty"]</R_Label>
                        </R_ItemLayout>
                    </R_StackLayout>

                </R_GroupBox>
                <R_GroupBox Title="@_localizer["_grp_billingstatement"]" Class="px-2">

                    @* statement date *@
                    <R_StackLayout Row>
                        <R_ItemLayout col="2">
                            <R_Label>@_localizer["_lbl_statementdate"]</R_Label>
                        </R_ItemLayout>
                        <R_ItemLayout col="1">
                            <R_NumericTextBox @bind-Value="@_viewModel.Data.IBILLING_STATEMENT_DATE" Min="1" Max="31" R_ConductorSource="@_conBillingRef" R_EnableAdd R_EnableEdit></R_NumericTextBox>
                        </R_ItemLayout>
                    </R_StackLayout>

                    @* TOP *@
                    <R_StackLayout Row>
                        <R_ItemLayout col="2"><R_Label>@_localizer["_lbl_termofpayment"]</R_Label></R_ItemLayout>
                        <R_ItemLayout col="3">
                            <R_TextBox @bind-Value="@_viewModel.Data.CBILLING_STATEMENT_TOP_CODE"
                                       R_ConductorSource="@_conBillingRef"
                                       OnLostFocus="@OnLostFocus_TermOfPaymentAsync"
                                       MaxLength="8"
                                       R_EnableAdd
                                       R_EnableEdit />
                        </R_ItemLayout>
                        <R_ItemLayout>
                            <R_Lookup R_Before_Open_Lookup="@BeforeOpenPopup_TOP"
                                      R_After_Open_Lookup="@AfterOpenPopup_TOP"
                                      R_ConductorSource="@_conBillingRef"
                                      R_EnableAdd
                                      R_EnableEdit>
                                ...
                            </R_Lookup>
                        </R_ItemLayout>
                        <R_ItemLayout auto="false">
                            <R_TextBox @bind-Value="@_viewModel.Data.CBILLING_STATEMENT_TOP_NAME" Enabled="@false"></R_TextBox>
                        </R_ItemLayout>
                    </R_StackLayout>

                </R_GroupBox>
            </R_StackLayout>

            @* buttons *@
            <R_StackLayout Row Justify="R_eJustify.SpaceBetween">
                <R_ItemLayout>
                    <R_StackLayout Row>
                        <R_ItemLayout Class="@(_viewModel._isRecordFound?"d-none":"d-block")"> <R_AddButton R_Conductor="@_conBillingRef" /> </R_ItemLayout>
                        <R_ItemLayout Class="@(_viewModel._isRecordFound?"d-block":"d-none")"> <R_EditButton R_Conductor="@_conBillingRef" /> </R_ItemLayout>
                    </R_StackLayout>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_StackLayout Row>
                        <R_ItemLayout> <R_CancelButton R_Conductor="@_conBillingRef" /> </R_ItemLayout>
                        <R_ItemLayout> <R_SaveButton R_Conductor="@_conBillingRef" /> </R_ItemLayout>
                    </R_StackLayout>
                </R_ItemLayout>
            </R_StackLayout>
        </R_StackLayout>
    </R_ItemLayout>
</R_StackLayout>

<R_ConductorGrid @ref="@_conPropertyRef" R_IsHeader></R_ConductorGrid>
<R_Conductor @ref="@_conBillingRef"
             R_ViewModel="@_viewModel"
             R_ConductorParent="@_conPropertyRef"
             R_ServiceGetRecord="@BillingParamForm_GetRecordAsync"
             R_Validation="@BillingParamForm_Validation"
             R_Saving="@BillingParamForm_Saving"
             R_ServiceSave="@BillingParamForm_SaveAsync"
             R_SetOther="@BillingParamForm_SetOtherAsync"
             R_CheckAdd="@BillingParam_CheckAdd"
             R_CheckEdit="@BillingParam_CheckEdit"></R_Conductor>