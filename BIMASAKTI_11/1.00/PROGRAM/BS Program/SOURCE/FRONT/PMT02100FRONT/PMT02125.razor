@inherits R_Page
@attribute [R_Page(Title = "Handover")]
@using PMT02100COMMON.DTOs
@using PMT02100MODEL.FrontDTOs.PMT02100;
@using PMT02100COMMON.DTOs.PMT02120;
@using PMT02100COMMON.DTOs.PMT02130;

<R_StackLayout Style="width:1250px">
    <R_StackLayout Row>
        <R_ItemLayout col="6">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_ConfirmedHODate"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_DateTimePicker R_ConductorGridSource="_conductorGridUnitRef"
                                  Enabled="false"
                                  @bind-Value="loViewModel.loHeader.DSCHEDULED_HO_DATE">
                    </R_DateTimePicker>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_Department"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CDEPT_CODE">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_RefNo"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CREF_NO">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_RefDate"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_DatePicker R_ConductorGridSource="_conductorGridUnitRef"
                                  Enabled="false"
                                  ShowPickerButton="false"
                                  @bind-Value="loViewModel.loHeader.DREF_DATE">
                    </R_DatePicker>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="6">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_ActualHODate"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_DateTimePicker R_ConductorGridSource="_conductorGridUnitRef"
                                      Enabled
                                      @bind-Value="loViewModel.loHeader.DHO_ACTUAL_DATE">
                    </R_DateTimePicker>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_Property"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CPROPERTY_ID">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CPROPERTY_NAME">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_Building"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CBUILDING_ID">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CBUILDING_NAME">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["_UnitTypeCategory"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CUNIT_TYPE_CATEGORY_ID">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_TextBox R_ConductorGridSource="_conductorGridUnitRef"
                               Enabled="false"
                               @bind-Value="loViewModel.loHeader.CUNIT_TYPE_CATEGORY_NAME">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout col="12">
            <R_Grid @ref="@_gridUnitRef"
                    DataSource="@loViewModel.loHandoverUnitList"
                    Pageable="true"
                    R_ConductorGridSource="@_conductorGridUnitRef"
                    R_GridType="@R_eGridType.Batch"
                    AllowAddNewRow="false"
                    AllowEditRow="true"
                    AllowDeleteRow="false"
                    Height="250px"
                    R_RowRender="@((R_GridRowRenderEventArgs args)=> R_RowRenderUnit(args))"
                    R_ServiceGetRecord="@Grid_Unit_ServiceGetRecord"
                    R_ServiceSave="@Grid_Unit_ServiceSave"
                    R_ServiceGetListRecord="@Grid_Unit_R_ServiceGetListRecord">
                <R_GridColumns>
                    <R_GridTextColumn FieldName=@nameof(PMT02130HandoverUnitDTO.CFLOOR_ID) HeaderText="@_localizer["_FloorId"]" Width="200px"></R_GridTextColumn>
                    <R_GridTextColumn FieldName=@nameof(PMT02130HandoverUnitDTO.CUNIT_ID) HeaderText="@_localizer["_UnitId"]" Width="150px"></R_GridTextColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02130HandoverUnitDTO.NGROSS_AREA_SIZE) Decimals="2" HeaderText="@_localizer["_GrossSize"]" Width="150px"></R_GridNumericColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02130HandoverUnitDTO.NNET_AREA_SIZE) Decimals="2" HeaderText="@_localizer["_NetSize"]" Width="150px"></R_GridNumericColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02130HandoverUnitDTO.NACTUAL_AREA_SIZE) Decimals="2" R_CellRender="@((R_GridCellRenderEventArgs args)=> Editable_Field_CellRender(args))" HeaderText="@(_localizer["_ActualSize"] + "*")" Width="150px" R_EnableEdit></R_GridNumericColumn>
                </R_GridColumns>
            </R_Grid>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout col="12">
            <R_Grid @ref="@_gridUtilityRef"
                    DataSource="@loViewModel.loHandoverUtilityList"
                    Pageable="true"
                    R_ConductorGridSource="@_conductorGridUtilityRef"
                    R_GridType="@R_eGridType.Batch"
                    AllowAddNewRow="false"
                    AllowEditRow="true"
                    AllowDeleteRow="false"
                    Height="250px"
                    R_ServiceGetRecord="@Grid_Utility_ServiceGetRecord"
                    R_RowRender="@((R_GridRowRenderEventArgs args)=> R_RowRenderUtility(args))"
                    R_ServiceSave="@Grid_Utility_ServiceSave"
                    R_SetEditGridColumn="@Grid_Utility_SetEditGridColumn"
                    R_ServiceGetListRecord="@Grid_Utility_R_ServiceGetListRecord">
                <R_GridColumns>
                    <R_GridTextColumn FieldName=@nameof(PMT02120HandoverUtilityDTO.CUNIT_ID) HeaderText="@_localizer["_UnitId"]" Width="110px"></R_GridTextColumn>
                    <R_GridTextColumn FieldName=@nameof(PMT02120HandoverUtilityDTO.CUTILITY_TYPE) HeaderText="@_localizer["_UtilityType"]" Width="120px"></R_GridTextColumn>
                    <R_GridTextColumn FieldName=@nameof(PMT02120HandoverUtilityDTO.CMETER_NO) HeaderText="@_localizer["_MeterNo"]" Width="120px"></R_GridTextColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02120HandoverUtilityDTO.NCAPACITY) Decimals="2" HeaderText="@_localizer["_Capacity"]" Width="105px"></R_GridNumericColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02120HandoverUtilityDTO.NCALCULATION_FACTOR) Decimals="2" HeaderText="@_localizer["_CF"]" Width="60px"></R_GridNumericColumn>
                    <R_GridTextColumn FieldName=@nameof(PMT02120HandoverUtilityDTO.CCHARGES_DISPLAY) HeaderText="@_localizer["_Charge"]" Width="120px"></R_GridTextColumn>
                    <R_GridNumericColumn TValue="int" FieldName=@nameof(PMT02120HandoverUtilityDTO.ISTART_INV_PRD_YEAR) HeaderText="@(_localizer["_StartYear"]+"*")" R_CellRender="@((R_GridCellRenderEventArgs args)=> Editable_Field_CellRender(args))" ThousandSeparator="false" Width="110px" R_EnableEdit></R_GridNumericColumn>
                    <R_GridComboBoxColumn Width="150px" Data="@loMonth"
                                          FieldName="@nameof(PMT02120HandoverUtilityDTO.ISTART_INV_PRD_MONTH)"
                                          ValueField="@nameof(PMT02125MonthDTO.VAR_MONTH_CODE)"
                                          TextField="@nameof(PMT02125MonthDTO.VAR_MONTH_NAME)"
                                          R_CellRender="@((R_GridCellRenderEventArgs args)=> Editable_Field_CellRender(args))"
                                          PopupMaxHeight="120px"
                                          HeaderText="@(_localizer["_StartMonth"]+"*")"
                                          R_EnableEdit />
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02120HandoverUtilityDTO.NMETER_START) R_CellRender="@((R_GridCellRenderEventArgs args)=> Editable_Meter_CellRender(args))" HeaderText="@_localizer["_MeterStart"]" Width="120px" R_EnableEdit></R_GridNumericColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02120HandoverUtilityDTO.NBLOCK1_START) Decimals="2" R_CellRender="@((R_GridCellRenderEventArgs args)=> Editable_Block_Start_CellRender(args))" HeaderText="@(_localizer["_Block1Start"]+"*")" Width="120px" R_EnableEdit></R_GridNumericColumn>
                    <R_GridNumericColumn TValue="decimal" FieldName=@nameof(PMT02120HandoverUtilityDTO.NBLOCK2_START) Decimals="2" R_CellRender="@((R_GridCellRenderEventArgs args)=> Editable_Block_Start_CellRender(args))" HeaderText="@(_localizer["_Block2Start"]+"*")" Width="125px" R_EnableEdit></R_GridNumericColumn>
                </R_GridColumns>
            </R_Grid>
        </R_ItemLayout>
    </R_StackLayout>
    <R_StackLayout Row>
        <R_ItemLayout col="12">
            <R_Label>@("*"+_localizer["_Information"])</R_Label>
        </R_ItemLayout>
    </R_StackLayout>
    <R_StackLayout Row>
        <R_ItemLayout col="12">
            <R_StackLayout Row Class="justify-content-end">
                <R_ItemLayout>
                    <R_Button OnClick="OnCancel">
                        @_localizer["_Cancel"]
                    </R_Button>
                    <R_Button OnClick="@OnHandover" Enabled="@(_conductorGridUnitRef.R_ConductorMode == R_BlazorFrontEnd.Enums.R_eConductorMode.Normal && _conductorGridUtilityRef.R_ConductorMode == R_BlazorFrontEnd.Enums.R_eConductorMode.Normal)">
                        @_localizer["_Handover"]
                    </R_Button>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
</R_StackLayout>

<R_ConductorGrid @ref="@_conductorGridUnitRef"
                 R_IsHeader>
</R_ConductorGrid>

<R_ConductorGrid @ref="@_conductorGridUtilityRef"
                 R_IsHeader>
</R_ConductorGrid>


<style>

    .editableField {
        background-color: var(--falcon-100) !important;
    }

    .k-grid .k-table-td.editableField:hover {
        background-color: var(--falcon-100) !important;
    }

    .k-grid .k-table-td.editableField {
        background-color: var(--falcon-100) !important;
    }

    .k-grid .k-master-row.rowDefaultColor:hover {
        background-color: var(--falcon-200);
    }

    .k-grid .k-master-row.rowDefaultColor {
        background-color: var(--falcon-200);
    }

    .k-grid .k-table-row.k-selected.rowDefaultColor > .k-table-td {
    }

</style>
