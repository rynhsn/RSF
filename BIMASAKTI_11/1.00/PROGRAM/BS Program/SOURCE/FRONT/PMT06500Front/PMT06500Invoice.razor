@page "/PMT06500Invoice"

@using PMT06500FrontResources
@using R_BlazorFrontEnd.Interfaces
@using PMT06500Common.DTOs
@inherits R_Page
@inject R_ILocalizer<Resources_Dummy_Class> _localizer

<R_StackLayout>
    <R_ItemLayout>
        <R_Grid @ref="_gridRefInvoice"
                DataSource="_viewModel.InvoiceGridList"
                R_ConductorGridSource="_conductorRefInvoice"
                R_GridType="R_eGridType.Original"
                R_ServiceGetListRecord="GetInvoiceListRecord"
                R_Display="DisplayInvoice"
                Pageable
                PageSize="7"
                AllowAddNewRow="false"
                AllowDeleteRow="false"
                AllowEditRow="false"
                Width="100%"
                Height="225px">
            <R_GridColumns>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CTRANS_STATUS_DESC)"
                                  HeaderText="@_localizer["STATUS"]" Width="100px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CDEPT_NAME)"
                                  HeaderText="@_localizer["DEPARTMENT"]" Width="200px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CREF_NO)" HeaderText="@_localizer["REF_NO"]"
                                  Width="200px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CPERIOD_DISPLAY)"
                                  HeaderText="@_localizer["INVOICE_PERIOD"]" Width="140px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CTENANT_NAME)"
                                  HeaderText="@_localizer["TENANT"]" Width="200px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CBUILDING_NAME)"
                                  HeaderText="@_localizer["BUILDING"]" Width="180px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CAGREEMENT_NO)"
                                  HeaderText="@_localizer["LOI_AGRMT_NO"]" Width="200px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CUPDATE_BY)"
                                  HeaderText="@_localizer["UPDATED_BY"]" Width="120px"/>
                <R_GridDateTimePickerColumn FieldName="@nameof(PMT06500InvoiceDTO.DUPDATE_DATE)"
                                            HeaderText="@_localizer["UPDATED_DATE"]" Width="180px"/>
                <R_GridTextColumn FieldName="@nameof(PMT06500InvoiceDTO.CCREATE_BY)"
                                  HeaderText="@_localizer["CREATED_BY"]" Width="120px"/>
                <R_GridDateTimePickerColumn FieldName="@nameof(PMT06500InvoiceDTO.DCREATE_DATE)"
                                            HeaderText="@_localizer["CREATED_DATE"]" Width="180px"/>
            </R_GridColumns>
        </R_Grid>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row>
    <R_ItemLayout>
        <R_Popup R_WithLock="true"
                 R_Before_Open_Popup="BeforeOpenPopupEditInvoice"
                 R_After_Open_Popup="AfterOpenPopupEditInvoice"
                 Enabled="@(_gridRefInvoice.HasData && int.TryParse(_viewModel.EntityInvoice.CTRANS_STATUS, out var status) && status < 10)">
            Edit
        </R_Popup>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Button OnClick="DeleteInvoice"
                  Enabled="@(_gridRefInvoice.HasData && int.TryParse(_viewModel.EntityInvoice.CTRANS_STATUS, out var status) && status < 10)">
            Delete
        </R_Button>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Popup R_Before_Open_Popup="BeforeOpenPopupViewInvoice"
                 Enabled="@(_gridRefInvoice.HasData)">
            View
        </R_Popup>
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Button OnClick="OnClickSubmit"
                  Enabled="@(_gridRefInvoice.HasData && int.TryParse(_viewModel.EntityInvoice.CTRANS_STATUS, out var status) && status < 30)">
            @(_viewModel.EntityInvoice.CTRANS_STATUS == "00" ? _localizer["SUBMIT"] : _localizer["DRAFT"])
        </R_Button>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout>
    <R_ItemLayout>
        <R_GroupBox Title="@_localizer["SUMMARY"]" TitleClass="text-danger" ShowBorder Class="p-2">
            <R_Grid @ref="_gridRefSummary"
                    DataSource="_viewModel.SummaryGridList"
                    R_ConductorGridSource="_conductorRefSummary"
                    R_GridType="R_eGridType.Original"
                    R_ServiceGetListRecord="GetSummaryListRecord"
                    Pageable
                    PageSize="7"
                    AllowAddNewRow="false"
                    AllowDeleteRow="false"
                    AllowEditRow="false"
                    Width="80%"
                    Height="225px">
                <R_GridColumns>
                    <R_GridTextColumn FieldName="@nameof(PMT06500SummaryDTO.CSERVICE)"
                                      HeaderText="@_localizer["SERVICE"]" Width="150px"/>
                    <R_GridTextColumn FieldName="@nameof(PMT06500SummaryDTO.CUNIT_NAME)"
                                      HeaderText="@_localizer["UNIT"]" Width="150px"/>
                    <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT06500SummaryDTO.NRATE_HOUR)"
                                         HeaderText="@_localizer["RATE_HOURS"]" Width="100px" Decimals="2"
                                         ThousandSeparator/>
                    <R_GridNumericColumn TValue="Int32" FieldName="@nameof(PMT06500SummaryDTO.IHOURS)"
                                         HeaderText="@_localizer["TOTAL_HOURS"]" Width="100px" Decimals="0"
                                         ThousandSeparator/>
                    <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT06500SummaryDTO.NAMOUNT)"
                                         HeaderText="@_localizer["TOTAL_AMOUNT"]" Width="100px" Decimals="2"
                                         ThousandSeparator/>
                </R_GridColumns>
            </R_Grid>
        </R_GroupBox>
    </R_ItemLayout>
</R_StackLayout>

<R_ConductorGrid @ref="_conductorRefInvoice"
                 R_IsHeader/>

<R_ConductorGrid @ref="_conductorRefSummary"
                 R_ConductorParent="_conductorRefInvoice"/>