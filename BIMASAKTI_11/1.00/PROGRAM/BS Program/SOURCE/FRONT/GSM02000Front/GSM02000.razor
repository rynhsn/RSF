@page "/GSM02000"
@using GSM02000Common.DTOs
@using GSM02000FrontResources
@using R_BlazorFrontEnd.Enums
@using R_BlazorFrontEnd.Interfaces
@inherits R_Page
@attribute [R_Page(Title = "Tax")]
@inject R_ILocalizer<Resources_Dummy_Class> _localizer

<R_StackLayout Spacing="3">
    <R_StackLayout>
        <R_Grid @ref="@_gridRef"
                DataSource="@_viewModel.GridList"
                Pageable
                PageSize="10"
                R_ConductorSource="@_conductorRef"
                R_GridType="@R_eGridType.Navigator"
                R_ServiceGetListRecord="@Grid_R_ServiceGetListRecord"
                Enabled="_gridEnabled"
                Height="280px"
                >
            <R_GridColumns>
                <R_GridCheckBoxColumn FieldName="@nameof(GSM02000GridDTO.LACTIVE)" HeaderText="@_localizer["LABEL_ACTIVE"]" Width="70px" Filterable="false" TextAlignment="R_eTextAlignment.Center"/>
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CTAX_ID)" HeaderText="@_localizer["LABEL_TAXID"]" Width="100px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CTAX_NAME)" HeaderText="@_localizer["LABEL_TAXNAME"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CROUNDING_MODE_DESCR)" HeaderText="@_localizer["LABEL_ROUNDINGMODE"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridNumericColumn TValue="int" FieldName="@nameof(GSM02000GridDTO.IROUNDING)" HeaderText="@_localizer["LABEL_ROUNDINGUNIT"]" Width="150px" TextAlignment="R_eTextAlignment.Right" Decimals="0"/>
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CTAXIN_GLACCOUNT_NO)" HeaderText="@_localizer["LABEL_TAXIN"]" Width="170px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CTAXOUT_GLACCOUNT_NO)" HeaderText="@_localizer["LABEL_TAXOUT"]" Width="180px" TextAlignment="R_eTextAlignment.Left"/>
                @* <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CDEDUCTION_TAX_NAME)" HeaderText="@_localizer["LABEL_DEDUCTION"]" Width="170px" TextAlignment="R_eTextAlignment.Left"/> *@
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CUPDATE_BY)" HeaderText="@_localizer["LABEL_UPDATEDBY"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridDateTimePickerColumn FieldName="@nameof(GSM02000GridDTO.DUPDATE_DATE)" HeaderText="@_localizer["LABEL_UPDATEDDATE"]" Width="200px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GSM02000GridDTO.CCREATE_BY)" HeaderText="@_localizer["LABEL_CREATEDBY"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridDateTimePickerColumn FieldName="@nameof(GSM02000GridDTO.DCREATE_DATE)" HeaderText="@_localizer["LABEL_CREATEDDATE"]" Width="200px" TextAlignment="R_eTextAlignment.Left"/>

            </R_GridColumns>
        </R_Grid>
    </R_StackLayout>
</R_StackLayout>

<R_StackLayout Row>
    <R_ItemLayout col="6">

        <R_StackLayout>
            <R_StackLayout Row="true">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_TAXID"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAX_ID"
                               R_ConductorSource="@_conductorRef"
                               R_EnableAdd="true"
                               R_EnableEdit="false" MaxLength="20"/>
                </R_ItemLayout>
                <R_ItemLayout col="4">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAX_NAME"
                               R_ConductorSource="@_conductorRef"
                               R_EnableAdd="true"
                               R_EnableEdit="true" MaxLength="100"/>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_CheckBox @bind-Value="@_viewModel.Data.LACTIVE"
                                R_ConductorSource="@_conductorRef"
                                Enabled="false"/>
                    <R_Label>@_localizer["LABEL_ACTIVE"]</R_Label>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row="true">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_DESCRIPTION"]</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="9">
                    <R_TextArea @bind-Value="@_viewModel.Data.CDESCRIPTION"
                                R_ConductorSource="@_conductorRef"
                                R_EnableAdd="true"
                                R_EnableEdit="true"/>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row="true">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_ROUNDINGMODE"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="9">
                    <R_StackLayout Row>
                        <R_ItemLayout col="4">
                            <R_ComboBox Data="@_viewModel.RoundingModeList"
                                        @bind-Value="@_viewModel.Data.CROUNDING_MODE"
                                        ValueField="@nameof(GSM02000RoundingDTO.CCODE)"
                                        TextField="@nameof(GSM02000RoundingDTO.CDESCRIPTION)"
                                        R_ConductorSource="@_conductorRef"
                                        R_EnableAdd="true"
                                        R_EnableEdit="true"
                                        OnChanged="ChangeRoundingMode"/>
                        </R_ItemLayout>

                        <R_ItemLayout>
                            <R_Label>@_localizer["LABEL_ROUNDINGUNIT"]*</R_Label>
                        </R_ItemLayout>

                        <R_ItemLayout col="2">
                            <R_NumericTextBox @bind-Value="@_viewModel.Data.IROUNDING"
                                              R_ConductorSource="@_conductorRef"
                                              Enabled="@(_viewModel.Data.CROUNDING_MODE != "03" && _conductorRef.R_ConductorMode != R_eConductorMode.Normal)"
                                              R_EnableAdd="true"
                                              R_EnableEdit="true"
                                              Min="-2"
                                              Max="2"
                                              Decimals="0"/>
                        </R_ItemLayout>
                        <R_ItemLayout>
                            <R_Label FontStyle="R_eFontStyle.Italic">(-2, -1, 0, 1, 2)</R_Label>
                        </R_ItemLayout>
                    </R_StackLayout>
                </R_ItemLayout>
                
            </R_StackLayout>

            <R_StackLayout Row="true">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_TAXIN"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_TextBox @ref="@_textTaxIn" @bind-Value="@_viewModel.Data.CTAXIN_GLACCOUNT_NO"
                               R_ConductorSource="@_conductorRef"
                               R_EnableAdd="true"
                               R_EnableEdit="true"
                               OnLostFocus="OnLostFocusGLAccountIn"/>
                </R_ItemLayout>

                <R_Lookup @ref="@R_LookupBtnIn"
                          R_Before_Open_Lookup="@BeforeOpenLookupIn"
                          R_After_Open_Lookup="@AfterOpenLookupIn">
                    ...
                </R_Lookup>

                <R_ItemLayout col="5">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAXIN_GLACCOUNT_NAME"
                               R_ConductorSource="@_conductorRef"
                               Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row="true">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_TAXOUT"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAXOUT_GLACCOUNT_NO"
                               R_ConductorSource="@_conductorRef"
                               R_EnableAdd="true"
                               R_EnableEdit="true"
                               OnLostFocus="OnLostFocusGLAccountOut"/>
                </R_ItemLayout>

                <R_Lookup @ref="@R_LookupBtnOut"
                          R_Before_Open_Lookup="@BeforeOpenLookupOut"
                          R_After_Open_Lookup="@AfterOpenLookupOut">
                    ...
                </R_Lookup>

                <R_ItemLayout col="5">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAXOUT_GLACCOUNT_NAME"
                               R_ConductorSource="@_conductorRef"
                               Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>

            @* <R_StackLayout Row="true"> *@
            @*     <R_ItemLayout col="2"> *@
            @*         <R_Label>@_localizer["LABEL_DEDUCTION"]</R_Label> *@
            @*     </R_ItemLayout> *@
            @* *@
            @*     <R_ItemLayout col="2"> *@
            @*         <R_TextBox @bind-Value="@_viewModel.Data.CDEDUCTION_TAX_ID" *@
            @*                    R_ConductorSource="@_conductorRef" *@
            @*                    R_EnableAdd="true" *@
            @*                    R_EnableEdit="true" *@
            @*                    OnLostFocus="OnLostFocusDeduction"/> *@
            @*     </R_ItemLayout> *@
            @* *@
            @*     <R_Lookup @ref="@R_LookupBtnDeduction" *@
            @*               R_Before_Open_Lookup="@BeforeOpenLookupDeduction" *@
            @*               R_After_Open_Lookup="@AfterOpenLookupDeduction"> *@
            @*         ... *@
            @*     </R_Lookup> *@
            @* *@
            @*     <R_ItemLayout col="4"> *@
            @*         <R_TextBox @bind-Value="@_viewModel.Data.CDEDUCTION_TAX_NAME" *@
            @*                    R_ConductorSource="@_conductorRef" *@
            @*                    Enabled="false"/> *@
            @*     </R_ItemLayout> *@
            @* </R_StackLayout> *@
        </R_StackLayout>
        
    </R_ItemLayout>
    
    <R_ItemLayout col="6" Class="ms-1">
        <R_Grid @ref="@_gridDeductionRef"
                DataSource="@_viewModel.DeductionGridList"
                Pageable
                PageSize="6"
                R_ConductorGridSource="@_conductorDeductionRef"
                R_GridType="@R_eGridType.Batch"
                R_ServiceGetListRecord="@GetListDeduction"
                AllowAddNewRow="true"
                AllowEditRow="true"
                AllowDeleteRow="true"
                Enabled="@(_conductorRef.R_ConductorMode != R_eConductorMode.Normal)"
                Width="100%"
                Height="200px"
                R_CellValueChanged="PropertyCellValueChanged"
                R_Before_Open_Grid_Lookup="BeforeLookupDeduction"
                R_After_Open_Grid_Lookup="AfterLookupDeduction"
                R_Validation="DeductionValidate"
                R_ServiceGetRecord="DeductionGetRecord"
                R_ServiceDelete="DeductionDelete"
        >
            <R_GridColumns>
                <R_GridDropDownListColumn Data="_viewModel.PropertyList"
                                          FieldName="@nameof(GSM02000DeductionGridDTO.CPROPERTY_ID)"
                                          ValueField="@nameof(GSM02000PropertyDTO.CPROPERTY_ID)"
                                          TextField="@nameof(GSM02000PropertyDTO.CPROPERTY_ID)"
                                          HeaderText="@_localizer["LABEL_PROPERTYID"]" 
                                          Width="150px"
                                          R_EnableAdd R_EnableEdit/>
                <R_GridTextColumn FieldName="@nameof(GSM02000DeductionGridDTO.CPROPERTY_NAME)" HeaderText="@_localizer["LABEL_PROPERTYNAME"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridLookupColumn FieldName="@nameof(GSM02000DeductionGridDTO.CDEDUCTION_TAX_ID)" HeaderText="@_localizer["LABEL_DEDUCTIONTAXID"]" Width="150px" TextAlignment="R_eTextAlignment.Left" R_EnableAdd="false" R_EnableEdit/>
                <R_GridTextColumn FieldName="@nameof(GSM02000DeductionGridDTO.CDEDUCTION_TAX_NAME)" HeaderText="@_localizer["LABEL_DEDUCTIONTAXNAME"]" Width="180px" TextAlignment="R_eTextAlignment.Left"/>
            </R_GridColumns>
        </R_Grid>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row="true" Spacing="5" Class="justify-content-between">
    <R_StackLayout Row>
        <R_ItemLayout>
            <R_AddButton R_Conductor="@_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_EditButton R_Conductor="@_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_DeleteButton R_Conductor="@_conductorRef"/>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout>
            <R_Popup R_ConductorSource="_conductorRef" 
                     R_EnableOther="true" 
                     R_After_Open_Popup="@AfterOpenActiveInactive" 
                     R_Before_Open_Popup="@BeforeOpenActiveInactive">@(_viewModel.Data.LACTIVE ? _localizer["BTN_INACTIVE"] : _localizer["BTN_ACTIVATE"])</R_Popup>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout>
            <R_CancelButton R_Conductor="@_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout Class="me-2">
            <R_SaveButton R_Conductor="@_conductorRef"/>
        </R_ItemLayout>
    </R_StackLayout>
</R_StackLayout>

<R_Conductor @ref="@_conductorRef"
             R_ViewModel="@_viewModel"
             R_IsHeader="true"
             R_ServiceGetRecord="@Conductor_ServiceGetRecord"
             R_SetOther="SetOther"
             R_AfterAdd="@Conductor_AfterAdd"
             R_Validation="Validation"
             R_BeforeCancel="BeforeCancel"
             R_ServiceSave="@Conductor_ServiceSave"
             R_AfterSave="Conductor_AfterSave"
             R_ServiceDelete="@Conductor_ServiceDelete"
             R_SetAdd="@R_SetAdd"
             R_SetEdit="@R_SetEdit"/>

<R_ConductorGrid @ref="_conductorDeductionRef"
                 R_ConductorParent="_conductorRef"/>

<R_PredefinedDock R_InstantiateDock="InstanceTaxTab" Title="Tax %"/>