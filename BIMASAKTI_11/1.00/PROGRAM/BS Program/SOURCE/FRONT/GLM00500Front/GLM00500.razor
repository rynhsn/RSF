@page "/GLM00500"
@using R_BlazorFrontEnd.Interfaces
@using GLM00500FrontResources
@inherits R_Page
@attribute [R_Page(Title = "List")]
@inject R_ILocalizer<Resources_Dummy_Class> _localizer

<R_StackLayout Row Class="mb-1">
    <R_ItemLayout>
        <R_Label>@_localizer["LABEL_YEAR"]</R_Label>
    </R_ItemLayout>
    <R_ItemLayout col="1">
        <R_NumericTextBox
            @bind-Value="@_viewModel.SelectedYear"
            Min="@_viewModel.Periods.IMIN_YEAR"
            Max="@_viewModel.Periods.IMAX_YEAR"
            R_ConductorSource="_conductorRef"
            Step="1" 
            ThousandSeparator="false"
            R_EnableOther/>
    </R_ItemLayout>
    <R_ItemLayout col="1">
        <R_Button R_ConductorSource="_conductorRef" OnClick="RefreshList" R_EnableOther>@_localizer["LABEL_BTNREFRESH"]</R_Button>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Class="mb-1">
    <R_ItemLayout>
        <R_Grid @ref="_gridRef"
                DataSource="_viewModel.BudgetHDList"
                Pageable
                PageSize="16"
                R_ConductorSource="_conductorRef"
                R_GridType="R_eGridType.Navigator"
                R_ServiceGetListRecord="GetBudgetHDList"
                Height="400px"
                Width="100%"
                Enabled="_gridEnabled">
            <R_GridColumns>
                <R_GridTextColumn FieldName="@nameof(GLM00500BudgetHDDTO.CBUDGET_NO)" HeaderText="@_localizer["LABEL_BUDGETNO"]" Width="120px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GLM00500BudgetHDDTO.CBUDGET_NAME)" HeaderText="@_localizer["LABEL_BUDGETNAME"]" Width="200px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GLM00500BudgetHDDTO.CCURRENCY_TYPE_NAME)" HeaderText="@_localizer["LABEL_CURRTYPE"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridCheckBoxColumn FieldName="@nameof(GLM00500BudgetHDDTO.LFINAL)" HeaderText="@_localizer["LABEL_FINAL"]" Width="80px" TextAlignment="R_eTextAlignment.Center"/>
                <R_GridTextColumn FieldName="@nameof(GLM00500BudgetHDDTO.CUPDATE_BY)" HeaderText="@_localizer["LABEL_UPDATEDBY"]" Width="120px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridDateTimePickerColumn FieldName="@nameof(GLM00500BudgetHDDTO.DUPDATE_DATE)" HeaderText="@_localizer["LABEL_UPDATEDDATE"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridTextColumn FieldName="@nameof(GLM00500BudgetHDDTO.CCREATE_BY)" HeaderText="@_localizer["LABEL_CREATEDBY"]" Width="120px" TextAlignment="R_eTextAlignment.Left"/>
                <R_GridDateTimePickerColumn FieldName="@nameof(GLM00500BudgetHDDTO.DCREATE_DATE)" HeaderText="@_localizer["LABEL_CREATEDDATE"]" Width="150px" TextAlignment="R_eTextAlignment.Left"/>
            </R_GridColumns>
        </R_Grid>

        <R_Conductor @ref="@_conductorRef"
                     R_ViewModel="@_viewModel"
                     R_IsHeader="true"
                     R_Display="@Display"
                     R_SetOther="SetOther"
                     R_AfterAdd="@AfterAdd"
                     R_ServiceGetRecord="@GetBudgetHD"
                     R_Validation="@ValidationBudgetHD"
                     R_ServiceSave="@SaveBudgetHD"
                     R_ServiceDelete="@DeleteBudgetHD"
                     R_AfterDelete="@AfterDeleteBudgetHD"
                     R_BeforeCancel="@BeforeCancelBudgetHD"/>
    </R_ItemLayout>
</R_StackLayout>

<R_GroupBox ShowBorder Class="mb-2" Title="@_localizer["LABEL_DETAIL"]">
    <R_StackLayout Row>
        <R_ItemLayout col="6">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_BUDGETNO"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @ref="_fieldBudgetNo" @bind-Value="_viewModel.Data.CBUDGET_NO"
                               R_ConductorSource="_conductorRef"
                               MaxLength="20"
                               R_EnableAdd/>
                </R_ItemLayout>
                <R_ItemLayout col="2">
                    <R_CheckBox @bind-Value="_viewModel.Data.LFINAL"
                                R_ConductorSource="_conductorRef"
                                Enabled="false"/>
                    <R_Label>@_localizer["LABEL_FINAL"]</R_Label>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_BUDGETNAME"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_TextBox @ref="_fieldBudgetName" @bind-Value="_viewModel.Data.CBUDGET_NAME"
                               R_ConductorSource="_conductorRef"
                               MaxLength="50"
                               R_EnableAdd
                               R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_CURRTYPE"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_ComboBox Data="_viewModel.CurrencyTypeList"
                                @bind-Value="_viewModel.Data.CCURRENCY_TYPE"
                                ValueField="@nameof(GLM00500FunctionDTO.CCODE)"
                                TextField="@nameof(GLM00500FunctionDTO.CNAME)"
                                R_ConductorSource="_conductorRef"
                                R_EnableAdd
                                R_EnableEdit/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="6">
            <R_StackLayout Row Class="mb-1">
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_UPDATEDBY"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="_viewModel.Data.CUPDATE_BY"
                               R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_DateTimePicker  @bind-Value="_viewModel.Data.DUPDATE_DATE"
                                      R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LABEL_CREATEDBY"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="_viewModel.Data.CCREATE_BY"
                               R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_DateTimePicker @bind-Value="_viewModel.Data.DCREATE_DATE"
                                      R_ConductorSource="_conductorRef" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
</R_GroupBox>

<R_StackLayout Row Class="d-flex justify-content-between">
    <R_StackLayout Row Class="justify-content-start">
        <R_ItemLayout>
            <R_AddButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_EditButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_DeleteButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row Class="justify-content-center">
        <R_ItemLayout>
            <R_Button
                OnClick="SetFinal"
                R_ConductorSource="_conductorRef"
                Enabled="@(_viewModel.BudgetHDEntity.LFINAL != true && _viewModel.BudgetHDEntity.LALLOW_FINAL && (_conductorRef.CurrentConductorStatus != R_eConductorStatus.Add && _conductorRef.CurrentConductorStatus != R_eConductorStatus.Edit))">
                Final
            </R_Button>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_Popup
                R_ConductorSource="_conductorRef"
                R_EnableOther
                R_Before_Open_Popup="BeforeOpenUpload"
                R_After_Open_Popup="AfterOpenUpload">
                @_localizer["LABEL_BTNUPLOAD"]
            </R_Popup>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_Button
                OnClick="DownloadTemplate"
                R_ConductorSource="_conductorRef"
                R_EnableOther
                >
                @_localizer["LABEL_BTNTEMPLATE"]
            </R_Button>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row Class="justify-content-end">
        <R_ItemLayout>
            <R_CancelButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_SaveButton R_Conductor="_conductorRef"/>
        </R_ItemLayout>
    </R_StackLayout>
</R_StackLayout>

<R_PredefinedDock R_InstantiateDock="InstanceDetailTab" Title="@_localizer["TITLE_DETAIL"]"/>