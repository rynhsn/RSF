@page "/PMB01600"
@using PMB01600Common.DTOs
@using PMB01600FrontResources
@inherits R_Page
@inject R_ILocalizer<Resources_Dummy_Class> _localizer

<R_StackLayout Row>
    <R_ItemLayout col="2">
        <R_Label FontColor="R_eFontColor.Danger">@_localizer["PROPERTY"]</R_Label>
    </R_ItemLayout>
    <R_ItemLayout col="3">
        <R_ComboBox Data="_viewModel.PropertyList"
                    Value="_viewModel.Param.CPROPERTY_ID"
                    ValueField="@nameof(PMB01600PropertyDTO.CPROPERTY_ID)"
                    TextField="@nameof(PMB01600PropertyDTO.CPROPERTY_NAME)"
                    ValueChanged="@((string value) => _valueChangedProperty(value))"
                    Enabled />
    </R_ItemLayout>
</R_StackLayout>


<R_StackLayout Row
               Class="mb-1">
    <R_ItemLayout col="2">
        <R_Label>
            @_localizer["Period"]*
        </R_Label>
    </R_ItemLayout>
    <R_ItemLayout col="1">
        <R_NumericTextBox @bind-Value="_viewModel.Param.IYEAR"
                          Step="1"
                          Decimals="0"
                          ThousandSeparator="false"
                          Min="_viewModel.YearRange.IMIN_YEAR"
                          Max="_viewModel.YearRange.IMAX_YEAR"
                                Arrows
                                Enabled />
    </R_ItemLayout>

    <R_ItemLayout col="1">
        <R_ComboBox Data="_viewModel.PeriodList"
                    Value="_viewModel.Param.CMONTH"
                    ValueField="@nameof(PMB01600PeriodDTO.CPERIOD_NO)"
                    TextField="@nameof(PMB01600PeriodDTO.CPERIOD_NO)"
                    ValueChanged="((string value) => _valueChangedPeriod(value))"
                    Enabled />
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row
               Class="mb-1">
    <R_ItemLayout col="2">
        <R_Label>@_localizer["From Tenant"]*</R_Label>
    </R_ItemLayout>
    <R_ItemLayout col="2">
        <R_TextBox @bind-Value="_viewModel.Param.CFROM_TENANT_ID"
                   MaxLength="20"
                   OnLostFocus="OnLostFocusFromTenant" />
    </R_ItemLayout>
    <R_Lookup R_Before_Open_Lookup="BeforeOpenLookupFromTenant"
              R_After_Open_Lookup="AfterOpenLookupFromTenant">
        ...
    </R_Lookup>
    <R_ItemLayout col="3">
        <R_TextBox @bind-Value="_viewModel.Param.CFROM_TENANT_NAME"
                   Enabled="false" />
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row
               Class="mb-1">
    <R_ItemLayout col="2">
        <R_Label>@_localizer["To Tenant"]*</R_Label>
    </R_ItemLayout>
    <R_ItemLayout col="2">
        <R_TextBox @bind-Value="_viewModel.Param.CTO_TENANT_ID"
                   MaxLength="20"
                   OnLostFocus="OnLostFocusToTenant" />
    </R_ItemLayout>
    <R_Lookup R_Before_Open_Lookup="BeforeOpenLookupToTenant"
              R_After_Open_Lookup="AfterOpenLookupToTenant">
        ...
    </R_Lookup>
    <R_ItemLayout col="3">
        <R_TextBox @bind-Value="_viewModel.Param.CTO_TENANT_NAME"
                   Enabled="false" />
    </R_ItemLayout>
    <R_ItemLayout>
        <R_Button OnClick="OnClickRefresh">@_localizer["Refresh"]</R_Button>
    </R_ItemLayout>
</R_StackLayout>

<R_StackLayout Row>
    <R_ItemLayout col="5">
        <R_Grid @ref="_gridRefHeader"
                DataSource="_viewModel.GridHeaderList"
                Pageable
                PageSize="12"
                R_ConductorGridSource="_conductorRefHeader"
                R_GridType="R_eGridType.Batch"
                R_ServiceGetListRecord="GetHeaderListRecord"
                AllowAddNewRow="false"
                AllowEditRow="false"
                AllowDeleteRow="false"
                Width="100%"
                Height="320px"
                R_Display="@DisplayHeader"
                R_CheckBoxSelectValueChanged="CheckBoxSelectValueChanged"
                R_ServiceSaveBatch="SaveBatch">
            <R_GridColumns>
                <R_GridCheckBoxSelectColumn FieldName="@nameof(PMB01600BillingStatementHeaderDTO.LSELECTED)"
                                            Width="30px" ShowSelectAllHeader Filterable="false"
                                            Resizable="false" />
                <R_GridTextColumn FieldName="@nameof(PMB01600BillingStatementHeaderDTO.CTENANT_NAME)"
                                  HeaderText="@_localizer["Tenant Name"]"
                                  TextAlignment="R_eTextAlignment.Left"
                                  Width="160px" />
                <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMB01600BillingStatementHeaderDTO.NTOTAL_AMT)"
                                     HeaderText="@_localizer["Total Amount"]"
                                     TextAlignment="R_eTextAlignment.Right"
                                     Width="140px"
                                     Decimals="2"
                                                  ThousandSeparator />
                <R_GridCheckBoxColumn FieldName="@nameof(PMB01600BillingStatementHeaderDTO.LDISTRIBUTE)"
                                      Width="120px"
                                      Filterable="true"
                                      HeaderText="@_localizer["Distribute"]"
                                      Resizable="false" />
            </R_GridColumns>
        </R_Grid>


        <R_ConductorGrid @ref="@_conductorRefHeader"
                              R_IsHeader />
    </R_ItemLayout>

    <R_ItemLayout col="7" Class="ps-2">
        <R_Grid @ref="_gridRefDetail"
                DataSource="_viewModel.GridDetailList"
                Pageable
                PageSize="12"
                R_ConductorGridSource="_conductorRefDetail"
                R_GridType="R_eGridType.Original"
                R_ServiceGetListRecord="GetDetailListRecord"
                AllowAddNewRow="false"
                AllowEditRow="false"
                AllowDeleteRow="false"
                Width="100%"
                Height="320px"
                R_CheckBoxSelectValueChanged="CheckBoxSelectValueChanged"
                R_ServiceSaveBatch="SaveBatch">
            <R_GridColumns>
                <R_GridTextColumn FieldName="@nameof(PMB01600BillingStatementDetailDTO.CSEQ_NO)"
                                  HeaderText="@_localizer["Seq No"]"
                                  TextAlignment="R_eTextAlignment.Left"
                                  Width="90px" />
                <R_GridTextColumn FieldName="@nameof(PMB01600BillingStatementDetailDTO.CCHARGES_TYPE)"
                                  HeaderText="@_localizer["Charges Type"]"
                                  TextAlignment="R_eTextAlignment.Left"
                                  Width="160px" />
                <R_GridTextColumn FieldName="@nameof(PMB01600BillingStatementDetailDTO.CCHARGES_DESC)"
                                  HeaderText="@_localizer["Charges"]"
                                  TextAlignment="R_eTextAlignment.Left"
                                  Width="160px" />
                <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMB01600BillingStatementDetailDTO.NTOTAL_AMOUNT)"
                                     HeaderText="@_localizer["Amount"]"
                                     TextAlignment="R_eTextAlignment.Right"
                                     Width="135px"
                                     Decimals="2"
                                                  ThousandSeparator />
            </R_GridColumns>
        </R_Grid>


        <R_ConductorGrid @ref="@_conductorRefDetail"
                         R_ConductorParent="@_conductorRefHeader" />
    </R_ItemLayout>
</R_StackLayout>


<R_StackLayout Class="mt-1">
    <R_ItemLayout col="12">
        <R_ProgressBar Label="@_viewModelBatch.Message" MaxValue="100"
        Value="@_viewModelBatch.Percentage"></R_ProgressBar>
        @*<R_ProgressBar Label="Message" MaxValue="100"
                       Value="100"></R_ProgressBar>*@
    </R_ItemLayout>

    <R_ItemLayout>
        <R_Button OnClick="OnClickProcess" Enabled="@_gridRefHeader.DataSource.Any(x=> x.LSELECTED)">Process</R_Button>
    </R_ItemLayout>
</R_StackLayout>


