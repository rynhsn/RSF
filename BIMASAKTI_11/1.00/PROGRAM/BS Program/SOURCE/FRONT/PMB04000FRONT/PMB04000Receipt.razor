@inherits R_Page
@inject R_ILocalizer<Resources_PMB0400_Class> _localizer
@attribute [R_Page(Title = "Receipt")]

<R_StackLayout Row>
    <R_ItemLayout col="6">
        @* Period *@
        <R_StackLayout Row>
            <R_ItemLayout col="2" Class="ms-2">
                <R_Label>@_localizer["_Period"]</R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="2" Class="ms-5">
                <R_NumericTextBox @bind-Value="_viewModelReceipt.oParameterReceipt.IPERIOD_YEAR"
                                  Min=_viewModelReceipt.oPeriodYearRange.IMIN_YEAR
                                  Max=_viewModelReceipt.oPeriodYearRange.IMAX_YEAR
                                  Enabled="@(!_viewModelReceipt.oParameterReceipt.LALL_PERIOD)"
                                  ThousandSeparator="false"
                                  Arrows="true" />
            </R_ItemLayout>
            <R_ItemLayout col="2" Class="pe-2">
                <R_ComboBox Data="@_viewModelReceipt.GetMonthList"
                            @bind-Value="_viewModelReceipt.oParameterReceipt.CPERIOD_MONTH"
                            ValueField="@nameof(PeriodMonthDTO.Id)"
                            TextField="@nameof(PeriodMonthDTO.Id)"
                            Enabled="@(!_viewModelReceipt.oParameterReceipt.LALL_PERIOD)"
                            PopupMaxHeight="100px">
                </R_ComboBox>
            </R_ItemLayout>
            <R_ItemLayout>
                <R_CheckBox @bind-Value="_viewModelReceipt.oParameterReceipt.LALL_PERIOD"
                            OnChanged="OnChangeAllPeriod" />
                <R_Label>@_localizer["AllPeriod"]</R_Label>
            </R_ItemLayout>
        </R_StackLayout>
    </R_ItemLayout>

    <R_ItemLayout col="6" Class="d-flex justify-content-end">
        <R_StackLayout Row>
            <R_ItemLayout>
                <R_CheckBox @bind-Value="_viewModelReceipt.oParameterPrintReceipt.LPRINT_ONE_TIME" />
                <R_Label>@_localizer["PrintOneTime"]</R_Label>
            </R_ItemLayout>
        </R_StackLayout>
    </R_ItemLayout>
</R_StackLayout>

<R_Grid @ref="@_grid"
        DataSource="_viewModelReceipt.loOfficialReceipt"
        R_ConductorGridSource="@_conductorRef"
        Pageable
        Height="325px"
        R_GridType="@R_eGridType.Batch"
        R_ServiceGetListRecord="@R_ServiceGetList"
        R_Display="@R_Display"
        R_ServiceSaveBatch="@ServiceSaveBatch"
        R_AfterSaveBatch="@AfterSaveBatch"
        AllowAddNewRow="false"
        AllowEditRow="false"
        AllowDeleteRow="false"
        R_CheckBoxSelectValueChanged="@R_CheckBoxSelectValueChanged">
    <R_GridColumns>

        <R_GridCheckBoxSelectColumn Width="80px"
                                    FieldName="@nameof(PMB04000DTO.LSELECTED)"
                                    ShowSelectAllHeader />
        <R_GridTextColumn Width="175px"
                          FieldName="@nameof(PMB04000DTO.CREF_NO)"
                          HeaderText="@_localizer["ReceiptNo"]" />
        <R_GridDatePickerColumn Width="150px"
                                FieldName="@nameof(PMB04000DTO.DREF_DATE)"
                                HeaderText="@_localizer["ReceiptDate"]" />
        <R_GridTextColumn Width="175px"
                          FieldName="@nameof(PMB04000DTO.CTENANT_ID)"
                          HeaderText="@_localizer["CustomerId"]" />
        <R_GridTextColumn Width="175px"
                          FieldName="@nameof(PMB04000DTO.CTENANT_NAME)"
                          HeaderText="@_localizer["CustomerName"]" />
        <R_GridNumericColumn Width="115px"
                             FieldName="@nameof(PMB04000DTO.IPRINT)"
                             TValue="int"
                             HeaderText="@_localizer["PrintNo"]" />
        <R_GridNumericColumn Width="135px"
                             FieldName="@nameof(PMB04000DTO.IDISTRIBUTE)"
                             TValue="int"
                             HeaderText="@_localizer["DistributeNo"]" />
    </R_GridColumns>
</R_Grid>

@* Buttom Button *@
<R_StackLayout Row="true" Spacing="3" Class="d-flex justify-content-between">

    <R_StackLayout Row>
        <R_ItemLayout>
            <R_Button Class="btn btn-light"
                      Enabled="@_viewModelReceipt._lReceiptExist"
                      OnClick="@BtnCancel">
                @_localizer["Cancel"]
            </R_Button>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row>
        <R_ItemLayout>
            <R_Label>@_localizer["TemplateFile"]</R_Label>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_ComboBox Data="@_viewModelReceipt.loTemplateList"
                        Value="_viewModelReceipt.pcValueTemplate"
                        ValueField="@nameof(TemplateDTO.CTEMPLATE_ID)"
                        TextField="@nameof(TemplateDTO.CTEMPLATE_NAME)"
                        Enabled="@_viewModelReceipt.llEnabledComboTemplate"
                        ValueChanged="@((string value)=> OnChangeTemplateList(value))" />
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row Class="d-flex justify-content-end">
        <R_ItemLayout>
            <R_Popup R_Before_Open_Popup="@BeforeOpen_PopupSaveAsAsync"
                     R_After_Open_Popup="@AfterOpen_PopupSaveAs"
                     Enabled="@_viewModelReceipt._lReceiptExist"
                     TabIndex="8">
                @_localizer["_btnSaveAs"]
            </R_Popup>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_PrintButton Class="btn btn-light"
                           OnClick="@BtnPrint"
                           Enabled="@(_viewModelReceipt is { _lReceiptExist: true, llEnabledComboTemplate: true })">
                @_localizer["Print"]
            </R_PrintButton>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_Button Class="btn btn-light"
                      Enabled="@_viewModelReceipt._lReceiptExist"
                      OnClick="@BtnDistribute">
                @_localizer["Distribute"]
            </R_Button>
        </R_ItemLayout>
    </R_StackLayout>
</R_StackLayout>

<R_StackLayout Row>
    <R_ItemLayout col="12">
        <R_ProgressBar Label="@_viewModelInvoice.Message" MaxValue="100" Value="@_viewModelInvoice.ProgressBarPercentage"></R_ProgressBar>
    </R_ItemLayout>
</R_StackLayout>

<R_ConductorGrid @ref="@_conductorRef"
                 R_IsHeader="true" />