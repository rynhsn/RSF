@inherits R_Page
@page "/PMB04000"
@attribute [R_Page(Title = "Generate Official Receipt")]
@inject R_ILocalizer<Resources_PMB0400_Class> _localizer

<R_StackLayout Row>
    @* header 1 *@
    <R_ItemLayout col="6">
        @* property *@
        <R_StackLayout Row>
            <R_ItemLayout col="3">
                <R_Label>@_localizer["_labelProperty"]*</R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="4" Class="pe-2 mb-2">
                <R_ComboBox Data="@_viewModel.loPropertyList"
                            Value="_viewModel.oParameterInvoice.CPROPERTY_ID"
                            ValueField="@nameof(PropertyDTO.CPROPERTY_ID)"
                            TextField="@nameof(PropertyDTO.CPROPERTY_NAME)"
                            ValueChanged="@((string value)=> OnChangedProperty(value))" />
            </R_ItemLayout>
        </R_StackLayout>

        @* Department *@
        <R_StackLayout Row>
            <R_ItemLayout col="3">
                <R_Label>
                    @_localizer["_Department"]*
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="3">
                <R_TextBox @bind-Value="@_viewModel.oParameterInvoice.CDEPT_CODE"
                           R_ConductorSource="@_conductorHeader"
                           MaxLength="20"
                           OnLostFocus="OnLostFocusDepartment" />
            </R_ItemLayout>
            <R_ItemLayout>
                <R_Lookup R_ConductorSource="@_conductorHeader"
                          R_Before_Open_Lookup="@BeforeOpenLookUpDepartmentLookup"
                          R_After_Open_Lookup="@AfterOpenLookUpDepartmentLookup">
                    ...
                </R_Lookup>
            </R_ItemLayout>
            <R_ItemLayout col="4">
                <R_TextBox @bind-Value="@_viewModel.oParameterInvoice.CDEPT_NAME"
                           R_ConductorSource="@_conductorHeader"
                           MaxLength="200"
                           Enabled="false" />

            </R_ItemLayout>
        </R_StackLayout>

        @* Tenant *@
        <R_StackLayout Row>
            <R_ItemLayout col="3">
                <R_Label>@_localizer["_Customer"]</R_Label>
            </R_ItemLayout>
            <R_ItemLayout col="3">
                <R_TextBox @bind-Value="@_viewModel.oParameterInvoice.CTENANT_ID"
                           R_ConductorSource="@_conductorHeader"
                           MaxLength="20"
                           OnLostFocus="@OnLostFocusTenant"
                           Enabled="@(!_viewModel.oParameterInvoice.LALL_TENANT)" />
            </R_ItemLayout>
            <R_ItemLayout>
                <R_Lookup R_ConductorSource="@_conductorHeader"
                          @ref="@R_LookupTenantLookup"
                          R_Before_Open_Lookup="@BeforeOpenLookUpTenantLookup"
                          R_After_Open_Lookup="@AfterOpenLookUpTenantLookupAsync"
                          Enabled="@(!_viewModel.oParameterInvoice.LALL_TENANT)">
                    ...
                </R_Lookup>
            </R_ItemLayout>

            <R_ItemLayout col="4">
                <R_TextBox R_ConductorSource="@_conductorHeader"
                           @bind-Value="@_viewModel.oParameterInvoice.CTENANT_NAME"
                           Enabled="false">
                </R_TextBox>
            </R_ItemLayout>
            <R_ItemLayout>
                <R_CheckBox @bind-Value="_viewModel.oParameterInvoice.LALL_TENANT"
                            R_ConductorSource="@_conductorHeader"
                            OnChanged="OnChangeAllTenant" />
                <R_Label>@_localizer["All"]</R_Label>
            </R_ItemLayout>

        </R_StackLayout>

        @* Invoice Type *@
        <R_StackLayout Row>
            <R_ItemLayout col="3">
                <R_Label>@_localizer["_InvoiceType"]*</R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="4" Class="mb-2 pe-1">
                <R_ComboBox R_ConductorSource="@_conductorHeader"
                            Data="@_viewModel.loInvoiceType"
                            Value="_viewModel.oParameterInvoice.CINVOICE_TYPE"
                            ValueField="@nameof(InvoiceTypeDTO.CCODE )"
                            TextField="@nameof(InvoiceTypeDTO.CNAME)"
                            ValueChanged="@((string value)=> OnChangedInvoiceType(value))" />
            </R_ItemLayout>

            <R_ItemLayout class="d-flex align-items-center"
                          col="1">
                <R_Button Class="btn btn-light"
                          OnClick="@BtnRefresh">
                    @_localizer["Refresh"]
                </R_Button>

            </R_ItemLayout>
        </R_StackLayout>

        
    </R_ItemLayout>
</R_StackLayout>

<R_TabStrip @ref="_tabStripInvoice" Class="mt-1" OnActiveTabIndexChanging="@OnActiveTabDepositIndexChangingAsync">
    <R_TabStripTab Title="Invoice List" Id="TabInvoiceList">
        <R_ItemLayout col="6">
            @* Period *@
            <R_StackLayout Row>
                <R_ItemLayout col="2" Class="ms-2">
                    <R_Label>@_localizer["_Period"]</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="2" Class="ms-5">
                    <R_NumericTextBox R_ConductorSource="@_conductorHeader"
                                      @bind-Value="_viewModel.oParameterInvoice.IPERIOD_YEAR"
                                      TValue="int"
                                      Min=_viewModel.oPeriodYearRange.IMIN_YEAR
                                      Max=_viewModel.oPeriodYearRange.IMAX_YEAR
                                      Enabled="@(!_viewModel.oParameterInvoice.LALL_PERIOD)"
                                      ThousandSeparator="false"
                                      Arrows="true" />
                </R_ItemLayout>
                <R_ItemLayout col="2" Class="pe-2">
                    <R_ComboBox R_ConductorSource="@_conductorHeader"
                                Data="@_viewModel.GetMonthList"
                                @bind-Value="_viewModel.oParameterInvoice.CPERIOD_MONTH"
                                ValueField="@nameof(PeriodMonthDTO.Id)"
                                TextField="@nameof(PeriodMonthDTO.Id)"
                                Enabled="@(!_viewModel.oParameterInvoice.LALL_PERIOD)"
                                PopupMaxHeight="100px">
                    </R_ComboBox>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_CheckBox @bind-Value="_viewModel.oParameterInvoice.LALL_PERIOD"
                                R_ConductorSource="@_conductorHeader"
                                OnChanged="OnChangeAllPeriod" />
                    <R_Label>@_localizer["AllPeriod"]</R_Label>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_Grid @ref="@_grid"
                DataSource="_viewModel.loInvoiceList"
                R_ConductorGridSource="@_conductorRef"
                Pageable
                Height="325px"
                R_GridType="@R_eGridType.Batch"
                R_ServiceGetListRecord="@R_ServiceGetList"
                R_Display="@R_Display"
                R_ServiceSaveBatch="@ServiceSaveBatch"
                R_AfterSaveBatch="@AfterSaveBatch"
                AllowAddNewRow="false"
                AllowEditRow="false"
                AllowDeleteRow="false"
                R_CheckBoxSelectValueChanged="@R_CheckBoxSelectValueChanged">
            <R_GridColumns>

                <R_GridCheckBoxSelectColumn Width="80px"
                                            FieldName="@nameof(PMB04000DTO.LSELECTED)"
                                                                ShowSelectAllHeader />
                <R_GridTextColumn Width="175px"
                                  FieldName="@nameof(PMB04000DTO.CTRANSACTION_NAME)"
                                  HeaderText="@_localizer["Transaction"]" />
                <R_GridTextColumn Width="175px"
                                  FieldName="@nameof(PMB04000DTO.CREF_NO)"
                                  HeaderText="@_localizer["InvoiceNo"]" />
                <R_GridDatePickerColumn FieldName="@nameof(PMB04000DTO.DREF_DATE)"
                                            HeaderText="@_localizer["InvoiceDate"]"
                                            Width="155px" />
                <R_GridTextColumn Width="175px"
                                  FieldName="@nameof(PMB04000DTO.CINVGRP_NAME)"
                                  HeaderText="@_localizer["InvoiceGroup"]" />
                <R_GridTextColumn Width="155px"
                                  FieldName="@nameof(PMB04000DTO.CTENANT_ID)"
                                  HeaderText="@_localizer["CustomerId"]" />
                <R_GridTextColumn Width="175px"
                                  FieldName="@nameof(PMB04000DTO.CTENANT_NAME)"
                                  HeaderText="@_localizer["CustomerName"]" />
                <R_GridTextColumn Width="200px"
                                  FieldName="@nameof(PMB04000DTO.CTRANS_DESC)"
                                  HeaderText="@_localizer["Description"]" />
                <!--  -->
            </R_GridColumns>
        </R_Grid>

        @* Receipt Date *@
        <R_StackLayout Row>
            <R_ItemLayout col="6">
                <R_StackLayout Row>
                    <R_ItemLayout col="3">
                        <R_Label>
                            @_localizer["ReceiptDate"]*
                        </R_Label>
                    </R_ItemLayout>
                    <R_ItemLayout col="4">
                        <R_DatePicker @bind-Value="@_viewModel.DCreateReceipt"
                                      R_ConductorSource="@_conductorHeader" />
                    </R_ItemLayout>
                    <R_ItemLayout col="3" class="d-flex align-items-center">
                        <R_Button Class="btn btn-light"
                                  OnClick="@BtnCreate"
                                  Enabled="@_viewModel._lPropertyExist">
                            @_localizer["Create"]
                        </R_Button>
                    </R_ItemLayout>
                </R_StackLayout>
            </R_ItemLayout>
        </R_StackLayout>

    </R_TabStripTab>

    <R_TabStripTab Title="Receipt Info" Id="TabReceiptInfo">
        <R_TabPage @ref="@_tabPageSubReceipt"
                   R_Before_Open_TabPage="Before_Open_ReceiptInfo" />

    </R_TabStripTab>
</R_TabStrip>
<R_ConductorGrid @ref="@_conductorRef"
                 R_IsHeader="true" />