@inherits R_Page
@attribute [R_Page(ResourceId = "_LOI")]

<R_StackLayout Style="@_StyleCallPopup">
    <R_StackLayout Row>
        <R_ItemLayout col="8">
            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_RefNo"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="4">
                    <R_TextBox @bind-Value="@_viewModel.Data.CREF_NO"
                               MaxLength="30"
                               Enabled="@(_viewModel.VAR_GSM_TRANS_CODE_LOI.LINCREMENT_FLAG == false && EnableAddMode)">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 2.66666667%">
                    <R_Label> </R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 12.5555556%">
                    <R_Label>@_localizer["_LOCRefNo"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 26%">
                    <R_TextBox @bind-Value="@_viewModel.Data.CLINK_REF_NO"
                               OnLostFocus="@LOCRefNo_OnLostFocus"
                               MaxLength="30"
                               Enabled="@(EnableAddMode)">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="0">
                    <R_Lookup R_Before_Open_Lookup="@LOCRefNo_Before_Open_Lookup"
                              R_After_Open_Lookup="@LOCRefNo_After_Open_Lookup"
                              Enabled="@(EnableAddMode)">...</R_Lookup>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_RefDate"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker @ref="@RefDate_DatePicker"
                                  @bind-Value="@_viewModel.Data.DREF_DATE"
                                  R_ConductorSource="@_conductorRef"
                                  R_EnableAdd
                                  R_EnableEdit>
                    </R_DatePicker>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 11%">
                    <R_Label> </R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 17.55555556%">
                    <R_Label>@_localizer["_FollowUpDate"]</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker @bind-Value="@_viewModel.Data.DFOLLOW_UP_DATE"
                                  R_ConductorSource="@_conductorRef"
                                  R_EnableAdd
                                  R_EnableEdit>
                    </R_DatePicker>
                </R_ItemLayout>
            </R_StackLayout>

             <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_Department"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @ref="@(DeptCode_TextBox)"
                               @bind-Value="@_viewModel.Data.CDEPT_CODE"
                               OnLostFocus="@DeptCode_OnLostFocus"
                               MaxLength="20"
                               Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="0">
                    <R_Lookup R_Before_Open_Lookup="@R_Before_Open_LookupDepartment"
                              R_After_Open_Lookup="@R_After_Open_LookupDepartment"
                              Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))">...</R_Lookup>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CDEPT_NAME"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>


            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_Tenant"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTENANT_ID"
                               R_ConductorSource="@_conductorRef"
                               MaxLength="20"
                               OnLostFocus="@(Tenant_OnLostFocus)"
                               Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="0">
                    <R_Lookup R_ConductorSource="@_conductorRef"
                              R_Before_Open_Lookup="@Tenant_Before_Open_Lookup"
                              R_After_Open_Lookup="@Tenant_After_Open_Lookup"
                              Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))">...</R_Lookup>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTENANT_NAME"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_Building"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Data.CBUILDING_ID"
                               R_ConductorSource="@_conductorRef"
                               Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))"
                               MaxLength="20"
                               OnLostFocus="@(Building_OnLostFocus)">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="0">
                    <R_Lookup R_ConductorSource="@_conductorRef"
                              R_Before_Open_Lookup="@Building_Before_Open_Lookup"
                              R_After_Open_Lookup="@Building_After_Open_Lookup"
                              Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))">...</R_Lookup>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CBUILDING_NAME"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_Salesman"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Data.CSALESMAN_ID"
                               R_ConductorSource="@_conductorRef"
                               Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))"
                               MaxLength="20"
                               OnLostFocus="@(Salesman_OnLostFocus)">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="0">
                    <R_Lookup R_ConductorSource="@_conductorRef"
                              R_Before_Open_Lookup="@Salesman_Before_Open_Lookup"
                              R_After_Open_Lookup="@Salesman_After_Open_Lookup"
                              Enabled="@(EnableAddMode && string.IsNullOrWhiteSpace(_viewModel.Data.CLINK_REF_NO))">...</R_Lookup>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CSALESMAN_NAME"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_PlanHODate"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker @bind-Value="@_viewModel.Data.DHO_PLAN_DATE"
                                  R_ConductorSource="@_conductorRef"
                                  R_EnableAdd
                                  R_EnableEdit>
                    </R_DatePicker>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 11%">
                    <R_CheckBox @bind-Value="@_viewModel.Data.LWITH_FO"
                                R_ConductorSource="@_conductorRef"
                                R_EnableAdd
                                R_EnableEdit>
                    </R_CheckBox>
                    <R_Label>@_localizer["_WithFO"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 17.55555556%">
                    <R_Label>@_localizer["_HODate"]</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker @bind-Value="@_viewModel.Data.DHO_ACTUAL_DATE"
                                      Enabled="false" ShowPickerButton="false">
                    </R_DatePicker>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_Tenure"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="1">
                    <R_NumericTextBox Value="@_viewModel.Data.IYEARS"
                                      ValueChanged="@((int value) => YearInt_ValueChanged(value))"
                                      R_ConductorSource="@_conductorRef"
                                      ThousandSeparator="false"
                                      Arrows="false"
                                      Decimals="0"
                                      Min="0"
                                      Max="100"
                                      R_EnableAdd
                                      R_EnableEdit>
                    </R_NumericTextBox>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_Label>@_localizer["_Year"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="1">
                    <R_NumericTextBox Value="@_viewModel.Data.IMONTHS"
                                      ValueChanged="@((int value) => MonthInt_ValueChanged(value))"
                                      R_ConductorSource="@_conductorRef"
                                      Arrows="false"
                                      Decimals="0"
                                      Min="0"
                                      Max="1200"
                                      R_EnableAdd
                                      R_EnableEdit>
                    </R_NumericTextBox>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_Label>@_localizer["_Month"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="1">
                    <R_NumericTextBox Value="@_viewModel.Data.IDAYS"
                                      ValueChanged="@((int value) => DayInt_ValueChanged(value))"
                                      R_ConductorSource="@_conductorRef"
                                      Arrows="false"
                                      Decimals="0"
                                      Min="0"
                                      Max="4380"
                                      R_EnableAdd
                                      R_EnableEdit>
                    </R_NumericTextBox>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_Label>@_localizer["_Day"]</R_Label>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_PlanStartDate"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker Value="@_viewModel.Data.DSTART_DATE"
                                  R_ConductorSource="@_conductorRef"
                                  ValueChanged="@((DateTime? value) => PlanStartDate_ValueChanged(value))"
                                  R_EnableAdd
                                  R_EnableEdit>
                    </R_DatePicker>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 11%">
                    <R_Label> </R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 17.55555556%">
                    <R_Label>@_localizer["_PlanEndDate"]*</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker Value="@_viewModel.Data.DEND_DATE"
                                  R_ConductorSource="@_conductorRef"
                                  ValueChanged="@((DateTime? value) => PlanEndDate_ValueChanged(value))"
                                  Min="@(_viewModel.Data.DSTART_DATE != null ? _viewModel.Data.DSTART_DATE.Value : DateTime.Now.AddDays(1))"
                                  R_EnableAdd
                                  R_EnableEdit>
                    </R_DatePicker>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_StartDate"]</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker @bind-Value="@_viewModel.Data.DACTUAL_START_DATE"
                                      Enabled="false" ShowPickerButton="false">
                    </R_DatePicker>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 11%">
                    <R_Label> </R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 17.55555556%">
                    <R_Label>@_localizer["_EndDate"]</R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_DatePicker @bind-Value="@_viewModel.Data.DACTUAL_END_DATE"
                                      Enabled="false" ShowPickerButton="false">
                    </R_DatePicker>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_UnitDescription"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 80%">
                    <R_TextBox @bind-Value="@_viewModel.Data.CUNIT_DESCRIPTION"
                               R_ConductorSource="@_conductorRef"
                               MaxLength="255"
                               R_EnableAdd
                               R_EnableEdit>
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["_Note"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout Style="width: 80%">
                    <R_TextArea @bind-Value="@_viewModel.Data.CNOTES"
                                R_ConductorSource="@_conductorRef"
                                MaxLength="int.MaxValue"
                                R_EnableAdd
                                R_EnableEdit>
                    </R_TextArea>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="4" Class="ms-3">
            <R_StackLayout Row>
                <R_ItemLayout col="12">
                    <R_Label>@_viewModel.Data.CTRANS_STATUS_DESCR</R_Label>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_DocumentStatus"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CAGREEMENT_STATUS_DESCR"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
            </R_StackLayout>


            <R_StackLayout Row><R_ItemLayout col="12"><R_Label></R_Label></R_ItemLayout></R_StackLayout>
            <R_StackLayout Row><R_ItemLayout col="12"><R_Label></R_Label></R_ItemLayout></R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_Currency"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CCURRENCY_CODE"
                               R_ConductorSource="@_conductorRef"
                               OnLostFocus="@Currency_OnLostFocus"
                               MaxLength="3"
                               R_EnableAdd
                               R_EnableEdit>
                    </R_TextBox>
                </R_ItemLayout>

                <R_ItemLayout col="0">
                    <R_Lookup R_Before_Open_Lookup="@Currency_Before_Open_Lookup"
                              R_After_Open_Lookup="@Currency_After_Open_Lookup"
                              R_ConductorSource="@_conductorRef"
                              R_EnableAdd
                              R_EnableEdit>
                        ...
                    </R_Lookup>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_LeaseMode"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_ComboBox Data="@_viewModel.VAR_LEASE_MODE"
                                @bind-Value="@_viewModel.Data.CLEASE_MODE"
                                PopupMaxHeight="140px"
                                ValueField="@nameof(PMT01300UniversalDTO.CCODE)"
                                TextField="@nameof(PMT01300UniversalDTO.CDESCRIPTION)"
                                R_ConductorSource="@_conductorRef"
                                R_EnableAdd
                                R_EnableEdit>
                    </R_ComboBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_ChargeMode"]*</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_ComboBox Data="@_viewModel.VAR_CHARGE_MODE"
                                @bind-Value="@_viewModel.Data.CCHARGE_MODE"
                                PopupMaxHeight="140px"
                                ValueField="@nameof(PMT01300UniversalDTO.CCODE)"
                                TextField="@nameof(PMT01300UniversalDTO.CDESCRIPTION)"
                                R_ConductorSource="@_conductorRef"
                                R_EnableAdd
                                R_EnableEdit>
                    </R_ComboBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row><R_ItemLayout col="12"><R_Label></R_Label></R_ItemLayout></R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="11">
                    <R_CheckBox @bind-Value="@_viewModel.Data.LPAY_OL_INCL_PENALTY"
                                R_ConductorSource="@_conductorRef"
                                R_EnableAdd
                                R_EnableEdit>
                    </R_CheckBox>
                    <R_Label>@_localizer["_Paymentonlineincludepenalty"]</R_Label>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row><R_ItemLayout col="12"><R_Label></R_Label></R_ItemLayout></R_StackLayout>
            <R_StackLayout Row><R_ItemLayout col="12"><R_Label></R_Label></R_ItemLayout></R_StackLayout>
            <R_StackLayout Row><R_ItemLayout col="12"><R_Label></R_Label></R_ItemLayout></R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_BillingRule"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CBILLING_RULE_CODE"
                               R_ConductorSource="@_conductorRef"
                               OnLostFocus="@BillingRule_OnLostFocus"
                               MaxLength="20"
                               R_EnableAdd
                               R_EnableEdit>
                    </R_TextBox>
                </R_ItemLayout>

                <R_ItemLayout col="0">
                    <R_Lookup R_Before_Open_Lookup="@BillingRule_Before_Open_Lookup"
                              R_After_Open_Lookup="@BillingRule_After_Open_Lookup"
                              R_ConductorSource="@_conductorRef"
                              R_EnableAdd
                              R_EnableEdit>
                        ...
                    </R_Lookup>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_BookingFee"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_NumericTextBox @bind-Value="@_viewModel.Data.NBOOKING_FEE"
                                      R_ConductorSource="@_conductorRef"
                                      Arrows="false"
                                      R_EnableAdd
                                      R_EnableEdit>
                    </R_NumericTextBox>
                </R_ItemLayout>
            </R_StackLayout>

            <R_StackLayout Row>
                <R_ItemLayout col="4">
                    <R_Label>@_localizer["_TC"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTC_CODE"
                               R_ConductorSource="@_conductorRef"
                               OnLostFocus="@TC_OnLostFocus"
                               MaxLength="20"
                               R_EnableAdd
                               R_EnableEdit>
                    </R_TextBox>
                </R_ItemLayout>

                <R_ItemLayout col="0">
                    <R_Lookup R_Before_Open_Lookup="@TC_Before_Open_Lookup"
                              R_After_Open_Lookup="@TC_After_Open_Lookup"
                              R_ConductorSource="@_conductorRef"
                              R_EnableAdd
                              R_EnableEdit>
                        ...
                    </R_Lookup>
                </R_ItemLayout>
            </R_StackLayout>

        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row Class="justify-content-between mt-2" hidden="@(HiddenButtonProgram)">
        <R_ItemLayout>
            <R_AddButton R_Conductor="@_conductorRef"></R_AddButton>
            <R_EditButton R_Conductor="@_conductorRef" Enabled="@(EnableNormalMode && EnableDraftSts)"></R_EditButton>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_Button R_ConductorSource="@_conductorRef" R_EnableHasData>@_localizer["_Print"]</R_Button>
            <R_Button Enabled="@(EnableNormalMode && EnableDraftSts)" OnClick="@SubmitProcess">@_localizer["_Submit"]</R_Button>
            <R_Button Enabled="@(EnableNormalMode && EnableOpenSts)" OnClick="@RedraftProcess">@_localizer["_Redraft"]</R_Button>
            <R_Button Enabled="@(EnableNormalMode && EnableApproveSts && _viewModel.Data.DHO_ACTUAL_DATE == null)" OnClick="@CancelLOIProcess">@_localizer["_CancelLOI"]</R_Button>
            <R_Button Enabled="@(EnableNormalMode && EnableApproveSts)" OnClick="@CloseLOIProcess">@_localizer["_TerminedLOI"]</R_Button>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_CancelButton R_Conductor="@_conductorRef"></R_CancelButton>
            <R_SaveButton R_Conductor="@_conductorRef"></R_SaveButton>
        </R_ItemLayout>
    </R_StackLayout>

    <R_StackLayout Row Class="mt-2" Justify="@R_eJustify.FlexEnd" hidden="@(CloseButtonOnly)">
        <R_ItemLayout>
            <R_Button OnClick="@CloseLOIProcess">@_localizer["_CloseLOI"]</R_Button>
        </R_ItemLayout>
    </R_StackLayout>

    <R_Conductor @ref="@_conductorRef"
                 R_ViewModel="@_viewModel"
                 R_IsHeader="true"
                 R_DisableCancelConfirmation
                 R_AfterAdd="@LOI_AfterAdd"
                 R_ServiceGetRecord="@LOI_ServiceGetRecord"
                 R_ServiceSave="@LOI_ServiceSave"
                 R_BeforeCancel="@LOI_BeforeCancel"
                 R_Validation="@LOI_Validation"
                 R_SetOther="@Grid_R_SetOther"
                 R_Display="@LOI_Display"
                 R_SetAdd="@LOI_SetAdd"
                 >
    </R_Conductor>
</R_StackLayout>



