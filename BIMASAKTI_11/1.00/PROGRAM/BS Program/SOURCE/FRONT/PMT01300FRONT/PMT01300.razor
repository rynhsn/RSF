@page "/PMT01300"
@inherits R_Page
@attribute [R_Page(ResourceId = "_LOILeaseUnit")]

<R_StackLayout Row>
    <R_ItemLayout col="1">
        <R_Label FontColor="@R_eFontColor.Danger" Class="fw-bold" FontSize="12">@_localizer["_Property"]</R_Label>
    </R_ItemLayout>

    <R_ItemLayout col="4">
        <R_ComboBox Data="@_viewModel.PropertyList"
                    Value="_viewModel.PROPERTY_ID"
                    PopupMaxHeight="140px"
                    ValueField="@nameof(PMT01300PropertyDTO.CPROPERTY_ID)"
                    TextField="@nameof(PMT01300PropertyDTO.CPROPERTY_NAME)"
                    Enabled="@(!_pageCRUDmode)"
                    ValueChanged="@((string value) => PropertyDropdown_ValueChanged(value))">
        </R_ComboBox>
    </R_ItemLayout>
</R_StackLayout>

<R_TabStrip @ref="@_TabLOIList">

    <R_TabStripTab @ref="@_TabLOIListStrip" Title="@_localizer["_LOIList"]" Id="LOIList">

        <R_StackLayout Row>
            <R_ItemLayout col="12">
                <R_RadioGroup Data="@_viewModel.TransStatusList"
                              Value="@_viewModel.CPAR_TRANS_STS"
                              ValueField="Key"
                              TextField="Value"
                              Layout="R_eRadioGroupLayout.Horizontal"
                              ValueChanged="@((string value) => TransStatusRadioButton_ValueChanged(value))"></R_RadioGroup>
            </R_ItemLayout>
        </R_StackLayout>

        <R_StackLayout Row>
            <R_ItemLayout col="12">
                <R_Grid @ref="@_gridLOIListRef"
                        DataSource="@_viewModel.LOIGrid"
                        Pageable="true"
                        R_ConductorSource="@_conRef"
                        R_GridType="@R_eGridType.Navigator"
                        R_ServiceGetListRecord="@Grid_LOI_ServiceGetListRecord"
                        Height="290px">
                    <R_GridColumns>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CDEPT_NAME)" HeaderText="@_localizer["_Department"]" Width="130px"></R_GridTextColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CREF_NO)" HeaderText="@_localizer["_RefNo"]" Width="200px"></R_GridTextColumn>
                        <R_GridDatePickerColumn FieldName="@nameof(PMT01300DTO.DREF_DATE)" HeaderText="@_localizer["_RefDate"]" Width="120px"></R_GridDatePickerColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CTENANT_NAME)" HeaderText="@_localizer["_Tenant"]" Width="200px"></R_GridTextColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CSALESMAN_NAME)" HeaderText="@_localizer["_Salesman"]" Width="200px"></R_GridTextColumn>
                        <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT01300DTO.NBOOKING_FEE)" HeaderText="@_localizer["_BookingFee"]" Width="120px"></R_GridNumericColumn>
                        <R_GridCheckBoxColumn FieldName="@nameof(PMT01300DTO.LPAID)" HeaderText="@_localizer["_Paid"]" Width="80px"></R_GridCheckBoxColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CTRANS_STATUS_DESCR)" HeaderText="@_localizer["_Status"]" Width="100px"></R_GridTextColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CDOC_TYPE)" HeaderText="@_localizer["_Document"]" Width="120px"></R_GridTextColumn>
                        <R_GridDatePickerColumn FieldName="@nameof(PMT01300DTO.DHO_ACTUAL_DATE)" HeaderText="@_localizer["_ActualHODate"]" Width="150px"></R_GridDatePickerColumn>
                        <R_GridDatePickerColumn FieldName="@nameof(PMT01300DTO.DOPEN_DATE)" HeaderText="@_localizer["_OpeningDate"]" Width="130px"></R_GridDatePickerColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CUNIT_NAME)" HeaderText="@_localizer["_UnitName"]" Width="120px"></R_GridTextColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CUPDATE_BY)" HeaderText="@_localizer["_UpdatedBy"]" Width="120px"></R_GridTextColumn>
                        <R_GridDateTimePickerColumn FieldName="@nameof(PMT01300DTO.DUPDATE_DATE)" HeaderText="@_localizer["_UpdatedDate"]" Width="180px"></R_GridDateTimePickerColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01300DTO.CCREATE_BY)" HeaderText="@_localizer["_CreatedBy"]" Width="120px"></R_GridTextColumn>
                        <R_GridDateTimePickerColumn FieldName="@nameof(PMT01300DTO.DCREATE_DATE)" HeaderText="@_localizer["_CreatedDate"]" Width="180px"></R_GridDateTimePickerColumn>
                    </R_GridColumns>
                </R_Grid>
            </R_ItemLayout>
        </R_StackLayout>

        <R_StackLayout Row>
            <R_ItemLayout col="6">
                <R_Grid @ref="@_gridLOIUnitListRef"
                        DataSource="@_viewModel.LOIUNITGrid"
                        Pageable="true"
                        AllowDeleteRow="false"
                        AllowEditRow="false"
                        AllowAddNewRow="false"
                        R_ServiceGetListRecord="@Grid_LOI_Unit_ServiceGetListRecord"
                        Height="190px">
                    <R_GridColumns>
                        <R_GridTextColumn FieldName="@nameof(PMT01310DTO.CFLOOR_ID)" HeaderText="@_localizer["_Floor"]" Width="90px"></R_GridTextColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01310DTO.CUNIT_ID)" HeaderText="@_localizer["_UnitId"]" Width="120px"></R_GridTextColumn>
                        <R_GridTextColumn FieldName="@nameof(PMT01310DTO.CUNIT_TYPE_ID)" HeaderText="@_localizer["_UnitType"]" Width="110px"></R_GridTextColumn>
                        <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT01310DTO.NGROSS_AREA_SIZE)" HeaderText="@_localizer["_Gross"]" Width="95px"></R_GridNumericColumn>
                        <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT01310DTO.NNET_AREA_SIZE)" HeaderText="@_localizer["_Net"]" Width="95px"></R_GridNumericColumn>
                    </R_GridColumns>
                </R_Grid>
            </R_ItemLayout>
        </R_StackLayout>

        <R_StackLayout Row>
            <R_ItemLayout>
                <R_Button Enabled="@(_viewModel.LOIGrid.Count > 0)">@_localizer["_Print"]</R_Button>
                <R_Button Enabled="@(_viewModel.LOIGrid.Count > 0 && EnableDraftSts)" OnClick="@SubmitProcess">@_localizer["_Submit"]</R_Button>
                <R_Button Enabled="@(_viewModel.LOIGrid.Count > 0 && EnableOpenSts)" OnClick="@RedraftProcess">@_localizer["_Redraft"]</R_Button>
                <R_Button Enabled="@(_viewModel.LOIGrid.Count > 0 && EnableApproveSts)" OnClick="@CancelLOIProcess">@_localizer["_CancelLOI"]</R_Button>
                <R_Button Enabled="@(_viewModel.LOIGrid.Count > 0 && EnableApproveSts)" OnClick="@CloseLOIProcess">@_localizer["_TerminedLOI"]</R_Button>
                <R_Button Class="ms-8" OnClick="@TemplateBtn_OnClick">@_localizer["_BTNTemplate"]</R_Button>
                <R_Popup Enabled="@(_viewModel.PropertyList.Count > 0)" R_Before_Open_Popup="@Upload_Before_Open_Popup" R_After_Open_Popup="@Upload_After_Open_Popup">@_localizer["_BTNUpload"]</R_Popup>
            </R_ItemLayout>
        </R_StackLayout>


        <R_Conductor @ref="@_conRef"
                         R_ViewModel="@_viewModel"
                         R_IsHeader="true"
                         R_ServiceGetRecord="@Grid_LOI_ServiceGetRecord"
                         R_Display="@Grid_LOI_Display"></R_Conductor>
    </R_TabStripTab>

    <R_TabStripTab @ref="@_TabLOIStrip" Title="@_localizer["_LOI"]" Id="LOI" Enabled="@(!string.IsNullOrWhiteSpace(_viewModel.PROPERTY_ID))">
        <R_TabPage @ref="@_TabPageLOI" R_Before_Open_TabPage="@LOITab_Before_Open_TabPage" R_After_Open_TabPage="@LOITab_After_Open_TabPage" R_TabEventCallback="@R_TabEventCallback"></R_TabPage>
    </R_TabStripTab>
    <R_TabStripTab @ref="@_TabLOIUnitStrip" Title="@_localizer["_UnitAndCharges"]" Id="UnitCharges" Enabled="@(_viewModel.LOIGrid.Count > 0 && !string.IsNullOrWhiteSpace(_viewModel.PROPERTY_ID))">
        <R_TabPage @ref="@_TabPageUnitAndCharges" R_Before_Open_TabPage="@UnitUtilitiesTab_Before_Open_TabPage" R_After_Open_TabPage="@LOITab_After_Open_TabPage" R_TabEventCallback="@R_TabEventCallback"></R_TabPage>
    </R_TabStripTab>
    <R_TabStripTab @ref="@_TabLOIInvoiceStrip" Title="@_localizer["_InvoicePlan"]" Id="InvoicePlan" Enabled="@(_viewModel.LOIGrid.Count > 0 && HasUnitData && !string.IsNullOrWhiteSpace(_viewModel.PROPERTY_ID))">
        <R_TabPage @ref="@_TabPageInvoicePlan" R_After_Open_TabPage="@LOITab_After_Open_TabPage" R_Before_Open_TabPage="@InvoicePlanTab_Before_Open_TabPage"></R_TabPage>
    </R_TabStripTab>
    <R_TabStripTab @ref="@_TabLOIDepositStrip" Title="@_localizer["_Deposit"]" Id="Deposit" Enabled="@(_viewModel.LOIGrid.Count > 0 && HasUnitData && !string.IsNullOrWhiteSpace(_viewModel.PROPERTY_ID))">
        <R_TabPage @ref="@_TabPageDeposit" R_Before_Open_TabPage="@DepositTab_Before_Open_TabPage" R_After_Open_TabPage="@LOITab_After_Open_TabPage" R_TabEventCallback="@R_TabEventCallback"></R_TabPage>
    </R_TabStripTab>
</R_TabStrip>
