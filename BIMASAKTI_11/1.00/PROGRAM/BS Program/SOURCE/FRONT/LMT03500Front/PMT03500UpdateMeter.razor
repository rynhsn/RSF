@page "/PMT03500UpdateMeter"
@using PMT03500FrontResources
@using R_BlazorFrontEnd.Interfaces
@using PMT03500Common.DTOs
@using PMT03500Common
@inherits R_Page
@inject R_ILocalizer<Resources_Dummy_Class> _localizer

<R_StackLayout>
<R_ItemLayout>
    <R_StackLayout Row>
        <R_ItemLayout col="5">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_BUILDING"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="7">
                    <R_TextBox @bind-Value="@_viewModel.Header.CBUILDING_ID"
                               OnChanged="OnChangeBuildingParam"
                               OnLostFocus="OnLostFocusLookupBuilding"/>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_Lookup R_Before_Open_Lookup="BeforeLookupBuilding" R_After_Open_Lookup="AfterLookupBuilding">...</R_Lookup>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_AGREEMENTNO"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="7">
                    <R_TextBox @bind-Value="@_viewModel.Header.CREF_NO" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="5">
            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["LBL_UNITID"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Header.CUNIT_ID" Enabled="@(_viewModel.LOTHER_UNIT)" OnLostFocus="OnLostFocusLookupUnit"/>
                </R_ItemLayout>
                <R_ItemLayout>
                    <R_Lookup R_Before_Open_Lookup="BeforeLookupBuildingUnit" R_After_Open_Lookup="AfterLookupBuildingUnit" Enabled="@(_viewModel.LOTHER_UNIT || _viewModel.Header.CBUILDING_ID is not (null or ""))">...</R_Lookup>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_TextBox @bind-Value="@_viewModel.Header.CUNIT_NAME" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
            <R_StackLayout Row>
                <R_ItemLayout col="2">
                    <R_Label>@_localizer["LBL_TENANT"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="3">
                    <R_TextBox @bind-Value="@_viewModel.Header.CTENANT_ID" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="6" Class="pe-1">
                    <R_TextBox @bind-Value="@_viewModel.Header.CTENANT_NAME" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout>
            <R_Button Enabled="@(_viewModel.Header.CUNIT_ID is not (null or ""))" OnClick="OnClickRefresh">@_localizer["LBL_REFRESH"]</R_Button>
        </R_ItemLayout>
    </R_StackLayout>
</R_ItemLayout>

<R_ItemLayout Class="mb-3" col="12">
    <R_StackLayout>
        <R_ItemLayout col="12">
            <R_Grid @ref="_gridRef"
                    DataSource="@_viewModel.GridList"
                    Pageable
                    R_ConductorSource="_conductorRef"
                    R_GridType="R_eGridType.Navigator"
                    R_ServiceGetListRecord="GetList"
                    Width="100%"
                    Height="270px">
                <R_GridColumns>
                    <R_GridTextColumn FieldName="@nameof(PMT03500UtilityMeterDTO.CUTILITY_TYPE_DESCR)" HeaderText="@_localizer["LBL_UTILITYTYPE"]" TextAlignment="R_eTextAlignment.Left" Width="100px"/>
                    <R_GridTextColumn FieldName="@nameof(PMT03500UtilityMeterDTO.CCHARGES_ID)" HeaderText="@_localizer["LBL_CHARGE"]" TextAlignment="R_eTextAlignment.Left" Width="100px"/>
                    <R_GridTextColumn FieldName="@nameof(PMT03500UtilityMeterDTO.CMETER_NO)" HeaderText="@_localizer["LBL_METERNO"]" TextAlignment="R_eTextAlignment.Left" Width="100px"/>
                    <R_GridTextColumn FieldName="@nameof(PMT03500UtilityMeterDTO.CSTATUS_DESCR)" HeaderText="@_localizer["LBL_STATUS"]" TextAlignment="R_eTextAlignment.Left" Width="70px"/>
                    <R_GridTextColumn FieldName="@nameof(PMT03500UtilityMeterDTO.CUPDATE_BY)" HeaderText="@_localizer["LBL_UPDBY"]" TextAlignment="R_eTextAlignment.Left" Width="120px"/>
                    <R_GridDateTimePickerColumn FieldName="@nameof(PMT03500UtilityMeterDTO.DUPDATE_DATE)" HeaderText="@_localizer["LBL_UPDDT"]" TextAlignment="R_eTextAlignment.Left" Width="140px"/>
                    <R_GridTextColumn FieldName="@nameof(PMT03500UtilityMeterDTO.CCREATE_BY)" HeaderText="@_localizer["LBL_CRTBY"]" TextAlignment="R_eTextAlignment.Left" Width="120px"/>
                    <R_GridDateTimePickerColumn FieldName="@nameof(PMT03500UtilityMeterDTO.DCREATE_DATE)" HeaderText="@_localizer["LBL_CRTDT"]" TextAlignment="R_eTextAlignment.Left" Width="140px"/>
                </R_GridColumns>
            </R_Grid>
        </R_ItemLayout>
    </R_StackLayout>
</R_ItemLayout>

<R_ItemLayout Class="mb-3">
    <R_StackLayout Row>
        <R_ItemLayout col="8">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_UTILITYTYPE"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="2">
                    <R_TextBox @bind-Value="_viewModel.Data.CUTILITY_TYPE_DESCR" Enabled="false"/>
                    @* <R_ComboBox Data="@_viewModel.UtilityTypeList" *@
                    @*             Value="_viewModel.Data.CUTILITY_TYPE" *@
                    @*             ValueField="@nameof(PMT03500FunctDTO.CCODE)" *@
                    @*             TextField="@nameof(PMT03500FunctDTO.CDESCRIPTION)" *@
                    @*             Enabled="false"/> *@
                                
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
    <R_StackLayout Row>
        <R_ItemLayout col="8">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_CHARGE"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="2">
                    <R_TextBox @bind-Value="_viewModel.Data.CCHARGES_ID" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="_viewModel.Data.CCHARGES_NAME" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_METERNO"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="8">
                    <R_TextBox @bind-Value="_viewModel.Data.CMETER_NO" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
    <R_StackLayout Row>
        <R_ItemLayout col="8">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_TAXCODE"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="2">
                    <R_TextBox @bind-Value="_viewModel.Data.CTAX_ID" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="_viewModel.Data.CTAX_NAME" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="4" Class="@(_viewModel.DisplayEC)">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_BLOCK1START"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    @* <R_TextBox @bind-Value="_viewModel.Data.CSTART_DATE" Enabled="false"/> *@
                    <R_NumericTextBox Value="@_viewModel.Data.NBLOCK1_START" Enabled="false" Arrows="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="4" Class="@(_viewModel.DisplayWG)">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_METERSTART"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    @* <R_TextBox @bind-Value="_viewModel.Data.CSTART_DATE" Enabled="false"/> *@
                    <R_NumericTextBox Value="@_viewModel.Data.NMETER_START" Enabled="false" Arrows="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
    <R_StackLayout Row Class="mb-1">
        <R_ItemLayout col="8">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_STARTINVPRD"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="4" Class="me-4">
                    <R_StackLayout Row>
                        <R_ItemLayout col="6">
                            <R_TextBox @bind-Value="_viewModel.Data.CYEAR_PERIOD" Enabled="false"/>
                            @* <R_ComboBox Data="@_viewModel.StartInvYearList" *@
                            @*             @bind-Value="_viewModel.Entity.CYEAR_PERIOD" *@
                            @*             ValueField="@nameof(PMT03500YearDTO.CYEAR)" *@
                            @*             TextField="@nameof(PMT03500YearDTO.CYEAR)" *@
                            @*             Enabled="false"/> *@

                        </R_ItemLayout>
                        <R_ItemLayout col="5" Class="pe-1">
                            <R_TextBox @bind-Value="_viewModel.Data.CPERIOD_NO" Enabled="false"/>
                            @*<R_ComboBox Data="@_viewModel.StartInvMonthList" *@
                            @*              @bind-Value="_viewModel.Data.CPERIOD_NO" *@
                            @*              ValueField="@nameof(PMT03500PeriodDTO.CPERIOD_NO)" *@
                            @*              TextField="@nameof(PMT03500PeriodDTO.CPERIOD_NO)" *@
                            @*              Enabled="false"/> *@
                        </R_ItemLayout>
                    </R_StackLayout>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_StackLayout Row>
                        <R_ItemLayout>
                            <R_Label>@_localizer["LBL_INVOICINGPERIOD"]</R_Label>
                        </R_ItemLayout>
                        <R_ItemLayout col="2">
                            <R_TextBox @bind-Value="_viewModel.Data.CINV_PRD" Enabled="false"/>
                        </R_ItemLayout>
                        <R_ItemLayout>
                            <R_Label>@_localizer["LBL_MONTHS"]</R_Label>
                        </R_ItemLayout>
                    </R_StackLayout>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="4" Class="@(_viewModel.DisplayEC)">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_BLOCK2START"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    @* <R_TextBox @bind-Value="_viewModel.Data.CSTART_DATE" Enabled="false"/> *@
                    <R_NumericTextBox Value="@_viewModel.Data.NBLOCK2_START" Enabled="false" Arrows="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
    <R_StackLayout Row>
        <R_ItemLayout col="8">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_INVGRP"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="2">
                    <R_TextBox @bind-Value="_viewModel.Data.CINV_GRP_CODE" Enabled="false"/>
                </R_ItemLayout>
                <R_ItemLayout col="6">
                    <R_TextBox @bind-Value="_viewModel.Data.CINV_GRP_NAME" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
        <R_ItemLayout col="4">
            <R_StackLayout Row>
                <R_ItemLayout col="3">
                    <R_Label>@_localizer["LBL_STATUS"]</R_Label>
                </R_ItemLayout>
                <R_ItemLayout col="5">
                    <R_TextBox @bind-Value="_viewModel.Data.CSTATUS_DESCR" Enabled="false"/>
                </R_ItemLayout>
            </R_StackLayout>
        </R_ItemLayout>
    </R_StackLayout>
</R_ItemLayout>

<R_GroupBox ShowBorder="false">
    <R_ItemLayout>
        <R_StackLayout Row>
            <R_Detail R_Before_Open_Detail="BeforeOpenAddMeterNo" Enabled="@(_viewModel.Header.CUNIT_ID is not (null or ""))">@_localizer["LBL_ADD"] @_localizer["LBL_METERNO"]</R_Detail>
            <R_Popup R_Before_Open_Popup="BeforeOpenUpdate" R_After_Open_Popup="AfterOpenUpdate" Enabled="@(_viewModel.GridList.Count > 0)">@_localizer["LBL_UPDATE"] @_localizer["LBL_METERNO"]</R_Popup>
            <R_Popup R_Before_Open_Popup="BeforeOpenChange" R_After_Open_Popup="AfterOpenChange" Enabled="@(_viewModel.GridList.Count > 0)">@_localizer["LBL_CHANGE"] @_localizer["LBL_METERNO"]</R_Popup>
        </R_StackLayout>
    </R_ItemLayout>
</R_GroupBox>

</R_StackLayout>
<R_Conductor @ref="_conductorRef"
             R_ViewModel="_viewModel"
             R_IsHeader
             R_ServiceGetRecord="GetRecord"/>