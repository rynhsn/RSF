@page "/PMT00500"
@inherits R_Page
@attribute [R_Page(ResourceId = "_OwnershipManager")]

<R_StackLayout Row>
    <R_ItemLayout col="1">
        <R_Label FontColor="@R_eFontColor.Danger" Class="fw-bold" FontSize="12">@_localizer["_Property"]</R_Label>
    </R_ItemLayout>

    <R_ItemLayout col="4">
        <R_ComboBox Data="@_viewModel.PropertyList"
                    Value="_viewModel.PROPERTY_ID"
                    PopupMaxHeight="140px"
                    ValueField="@nameof(PMT00500PropertyDTO.CPROPERTY_ID)"
                    TextField="@nameof(PMT00500PropertyDTO.CPROPERTY_NAME)"
                    Enabled="@(!_pageCRUDmode)"
                    ValueChanged="@((string value) => PropertyDropdown_ValueChanged(value))">
        </R_ComboBox>
    </R_ItemLayout>
</R_StackLayout>

<R_TabStrip @ref="@_TabUnitList">
    <R_TabStripTab @ref="@_TabUnitListStrip" Title="@_localizer["_UnitList"]" Id="UnitList">
        <R_StackLayout Row>
            <R_ItemLayout col="1">
                <R_Label FontColor="@R_eFontColor.Default" Class="fw-bold" FontSize="14">@_localizer["Building"]</R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="2">
                <R_TextBox @bind-Value="@_viewModel.BuildingUnit.CBUILDING_ID"
                           Enabled="true"
                           MaxLength="20"
                           OnLostFocus="OnLostFocus_LookupBuilding" />
            </R_ItemLayout>
            <R_ItemLayout>
                <R_Lookup R_Before_Open_Lookup="@BeforeOpen_lookupBuilding" R_After_Open_Lookup="@AfterOpen_lookupBuildingAsync">
                    ...
                </R_Lookup>
            </R_ItemLayout>
            <R_ItemLayout col="3">
                <R_TextBox @bind-Value="@_viewModel.BuildingUnit.CBUILDING_NAME"
                           Enabled="false" />
            </R_ItemLayout>
            <R_ItemLayout>
                <R_Label FontColor="@R_eFontColor.Default" FontStyle="@R_eFontStyle.Bold" FontSize="14" Class="me-2">@_localizer["_NotYetHO"] : @_NotYetHO @_localizer["_Units"]</R_Label>
                <R_Label FontColor="@R_eFontColor.Default" FontStyle="@R_eFontStyle.Bold" FontSize="14" Class="me-2">@_localizer["_ConfirmedHO"] : @_ConfirmedHO @_localizer["_Units"]</R_Label>
                <R_Label FontColor="@R_eFontColor.Default" FontStyle="@R_eFontStyle.Bold" FontSize="14">@_localizer["_DoneHO"] : @_DoneHO @_localizer["_Units"]</R_Label>
            </R_ItemLayout>
        </R_StackLayout>
        <R_StackLayout Row>
            <R_ItemLayout>
                <R_StackLayout Row>
                    <R_Grid @ref="@_gridBuildingUnitListRef"
                            DataSource="@_viewModel.BuildingUnitGrid"
                            Pageable="true"
                            AllowDeleteRow="false"
                            AllowEditRow="false"
                            AllowAddNewRow="false"
                            R_ServiceGetListRecord="@Grid_Building_Unit_ServiceGetListRecord"
                            R_ConductorGridSource="@_conductorGridRef"
                            R_ServiceGetRecord="@Grid_Building_Unit_ServiceGetRecord"
                            R_Display="@Grid_Building_Unit_Display"
                            R_CheckBoxSelectValueChanged="@Grid_Building_Unit_CheckBoxSelectValueChanged"
                            Height="300px"
                            Width="1100px">
                        <R_GridColumns>
                             <R_GridCheckBoxSelectColumn Width="28px" FieldName="@nameof(PMT00500BuildingUnitDTO.LCHECKED)" ShowSelectAllHeader></R_GridCheckBoxSelectColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CFLOOR_ID)" HeaderText="@_localizer["_Floor"]" Width="80px"></R_GridTextColumn> 
                             <R_GridLookupColumn MaxLength="30" FieldName="@nameof(PMT00500BuildingUnitDTO.CUNIT_ID)" R_EnableAdd HeaderText="@_localizer["_UnitId"]" Width="100px"></R_GridLookupColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CUNIT_TYPE_ID)" HeaderText="@_localizer["_UnitType"]" Width="100px"></R_GridTextColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CSTRATA_TENANT_NAME)" HeaderText="@_localizer["_BuyerOwnerName"]" Width="169px"></R_GridTextColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CSTRATA_STATUS_DESC)" HeaderText="@_localizer["_StrataStatus"]" Width="130px"></R_GridTextColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CSTRATA_HO_STATUS_DESC )" HeaderText="@_localizer["_HO Status"]" Width="110px"></R_GridTextColumn> 
                             <R_GridDatePickerColumn FieldName="@nameof(PMT00500BuildingUnitDTO.DSTRATA_HO_ACTUAL_DATE)" HeaderText="@_localizer["_HODate"]" Width="100px"></R_GridDatePickerColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CLEASE_STATUS_DESC)" HeaderText="@_localizer["_LeaseStatus"]" Width="120px"></R_GridTextColumn> 
                             <R_GridNumericColumn TValue="int" FieldName="@nameof(PMT00500BuildingUnitDTO.IREINVITATION_COUNT)" HeaderText="@_localizer["_Invitation"]" Width="112px"></R_GridNumericColumn> 

                             <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT00500BuildingUnitDTO.NGROSS_AREA_SIZE)" HeaderText="@_localizer["_Gross"]" Width="80px"></R_GridNumericColumn> 
                             <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT00500BuildingUnitDTO.NNET_AREA_SIZE)" HeaderText="@_localizer["_Net"]" Width="70px"></R_GridNumericColumn> 
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CUNIT_VIEW_NAME)" HeaderText="@_localizer["_UnitView"]" Width="110px"></R_GridTextColumn> 

                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CUPDATE_BY)" HeaderText="@_localizer["_UpdatedBy"]" Width="120px"></R_GridTextColumn>
                             <R_GridDateTimePickerColumn FieldName="@nameof(PMT00500BuildingUnitDTO.DUPDATE_DATE)" HeaderText="@_localizer["_UpdatedDate"]" Width="180px"></R_GridDateTimePickerColumn>
                             <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CCREATE_BY)" HeaderText="@_localizer["_CreatedBy"]" Width="120px"></R_GridTextColumn>
                             <R_GridDateTimePickerColumn FieldName="@nameof(PMT00500BuildingUnitDTO.DCREATE_DATE)" HeaderText="@_localizer["_CreatedDate"]" Width="180px"></R_GridDateTimePickerColumn>
                         </R_GridColumns>
                     </R_Grid>
                 </R_StackLayout>
                   <R_StackLayout Row>
                        <R_ItemLayout>
                            <R_StackLayout hidden="true">
                                <R_Popup Enabled="@(_viewModel.BuildingUnitGrid.Count > 0 && _LoBuildingUnitData.CSTRATA_STATUS == ContextConstant.VAR_SOLD_STS)">@_localizer["_MoveBuyer"]</R_Popup>
                            </R_StackLayout>
                            <R_Popup R_Before_Open_Popup="@ChangeOwner_Before_Open_Popup" R_After_Open_Popup="@ChangeOwner_After_Open_Popup"
                                     Enabled="@(_viewModel.BuildingUnitGrid.Count > 0 && _LoBuildingUnitData.CSTRATA_TRX_STATUS == "30")">@_localizer["_ChangeOwner"]</R_Popup>
                            <R_Popup R_Before_Open_Popup="@Lease_Before_Open_Popup" R_After_Open_Popup="@Lease_After_Open_Popup"
                                     Enabled="@(_viewModel.BuildingUnitGrid.Count > 0 && _LoBuildingUnitData.CSTRATA_TRX_STATUS == "30")">@_localizer["_Lease"]</R_Popup>
                            <R_Popup R_Before_Open_Popup="@CloseLease_Before_Open_Popup" R_After_Open_Popup="@CloseLease_After_Open_Popup"
                                     Enabled="@(_viewModel.BuildingUnitGrid.Count > 0 && _LoBuildingUnitData.CLEASE_TRX_STATUS == "30")">@_localizer["_CloseLease"]</R_Popup>
                            <R_Button OnClick="ViewTransaction_OnClick"
                                     Enabled="@(_viewModel.BuildingUnitGrid.Count > 0 && _LoBuildingUnitData.CSTRATA_STATUS == ContextConstant.VAR_SOLD_STS)">@_localizer["_ViewTransaction"]</R_Button>
                        </R_ItemLayout>
                    </R_StackLayout>
                 <R_StackLayout Row>
                    <R_Grid @ref="@_gridSelectedBuildingUnitListRef"
                            DataSource="@_viewModel.SelectedBuildingUnitGrid"
                            Pageable="true"
                            AllowDeleteRow="false"
                            AllowEditRow="false"
                            AllowAddNewRow="false"
                            R_ServiceGetListRecord="@Grid_Selected_Building_Unit_ServiceGetListRecord"
                            Height="200px">
                        <R_GridColumns>
                            <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CFLOOR_ID)" HeaderText="@_localizer["_Floor"]" Width="90px"></R_GridTextColumn>
                            <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CUNIT_ID)" HeaderText="@_localizer["_UnitId"]" Width="120px"></R_GridTextColumn>
                            <R_GridTextColumn FieldName="@nameof(PMT00500BuildingUnitDTO.CUNIT_TYPE_ID)" HeaderText="@_localizer["_UnitType"]" Width="110px"></R_GridTextColumn>
                            <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT00500BuildingUnitDTO.NGROSS_AREA_SIZE)" HeaderText="@_localizer["_Gross"]" Width="95px"></R_GridNumericColumn>
                            <R_GridNumericColumn TValue="decimal" FieldName="@nameof(PMT00500BuildingUnitDTO.NNET_AREA_SIZE)" HeaderText="@_localizer["_Net"]" Width="95px"></R_GridNumericColumn>
                        </R_GridColumns>
                    </R_Grid>
                </R_StackLayout>
            </R_ItemLayout>
        </R_StackLayout>

        <R_StackLayout Row>
            <R_ItemLayout>
                <R_Popup R_Before_Open_Popup="@NewAgreement_Before_Open_Popup" R_After_Open_Popup="@NewAgreement_After_Open_Popup"
                         Enabled="@(_viewModel.SelectedBuildingUnitGrid.Count > 0 && _viewModel.SelectedBuildingUnitGrid.Any(x => x.CSTRATA_STATUS == ContextConstant.VAR_AVAIL_STS))">@_localizer["_NewAgreement"]</R_Popup>
            </R_ItemLayout>
        </R_StackLayout>

    </R_TabStripTab>

    <R_TabStripTab @ref="@_TabAgreementStrip" Title="@_localizer["_Agreement"]" Id="Agreement" >
        <R_TabPage @ref="@_TabPageAgreement" R_Before_Open_TabPage="@BuildingTab_Before_Open_TabPage" R_After_Open_TabPage="@BuildingTab_After_Open_TabPage" R_TabEventCallback="@R_TabEventCallback"></R_TabPage>
    </R_TabStripTab>

</R_TabStrip>

<R_ConductorGrid @ref="_conductorGridRef"
                 R_IsHeader>
</R_ConductorGrid>
